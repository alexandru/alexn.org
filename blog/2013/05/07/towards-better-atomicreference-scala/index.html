<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="color-scheme" content="light dark">
    <!--https://developers.google.com/web/fundamentals/design-and-ux/browser-customization-->
    <meta name="theme-color" content="#493667">
    
    <title>Towards a Better AtomicReference - Alexandru Nedelcu</title>
    

    <!-- Open Graph Meta -->
    <meta content="Alexandru Nedelcu" property="og:site_name">
    <meta content="Towards a Better AtomicReference" property="og:title">
    
      <meta content="On programming and personal projects" property="og:description">
    <meta content="https://alexn.org/blog/2013/05/07/towards-better-atomicreference-scala/" property="og:url">
    <meta content="2013-05-07T00:00:00+00:00" property="article:published_time">
    
    <meta content="website" property="og:type">
    <meta property="og:image" content="https://alexn.org/assets/logo/800px-bordered.png" />
    <meta property="og:image:secure_url" content="https://alexn.org/assets/logo/800px-bordered.png" />
    <!-- Twitter Cards -->
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image:src" content="https://alexn.org/assets/logo/800px-bordered.png">
    <meta name="twitter:site" content="@alexelcu">
    <meta name="twitter:creator" content="@alexelcu">
    <meta name="twitter:title" content="Towards a Better AtomicReference">
    <meta name="twitter:url" content="https://alexn.org/blog/2013/05/07/towards-better-atomicreference-scala/">
    
      <meta name="twitter:description" content="On programming and personal projects">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="48x48" />
    <link rel="icon" href="/assets/logo/16px.png" sizes="16x16" />
    <link rel="icon" href="/assets/logo/32px.png" sizes="32x32" />
    <link rel="icon" href="/assets/logo/192px.png" sizes="192x192" />
    <link rel="icon" href="/assets/logo/270px.png" sizes="270x270" />
    <link rel="icon" href="/assets/logo/512px.png" sizes="512x512" />
    <link rel="apple-touch-icon-precomposed" href="/assets/logo/180px.png" />
    <meta name="msapplication-TileImage" content="/assets/logo/270px.png" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="All articles (blog + wiki)" href="/feeds/all.xml" />
    <link rel="alternate" type="application/rss+xml" title="Blog" href="/feeds/blog.xml" />
    <link rel="alternate" type="application/rss+xml" title="Wiki" href="/feeds/wiki.xml" />

    <!-- Points at alexn.org, taking care of the search-engine indexing of mirrors: -->
    <link rel="canonical" href="https://alexn.org/blog/2013/05/07/towards-better-atomicreference-scala/">
    
    <style type="text/css" media="all">
      /*! normalize.css v6.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:0.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url("/assets/fonts/fira-code-v8-latin-300.eot");src:local(""),url("/assets/fonts/fira-code-v8-latin-300.eot?#iefix") format("embedded-opentype"),url("/assets/fonts/fira-code-v8-latin-300.woff2") format("woff2"),url("/assets/fonts/fira-code-v8-latin-300.woff") format("woff"),url("/assets/fonts/fira-code-v8-latin-300.ttf") format("truetype"),url("/assets/fonts/fira-code-v8-latin-300.svg#FiraCode") format("svg")}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url("/assets/fonts/fira-code-v8-latin-500.eot");src:local(""),url("/assets/fonts/fira-code-v8-latin-500.eot?#iefix") format("embedded-opentype"),url("/assets/fonts/fira-code-v8-latin-500.woff2") format("woff2"),url("/assets/fonts/fira-code-v8-latin-500.woff") format("woff"),url("/assets/fonts/fira-code-v8-latin-500.ttf") format("truetype"),url("/assets/fonts/fira-code-v8-latin-500.svg#FiraCode") format("svg")}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url("/assets/fonts/fira-code-v8-latin-regular.eot");src:local(""),url("/assets/fonts/fira-code-v8-latin-regular.eot?#iefix") format("embedded-opentype"),url("/assets/fonts/fira-code-v8-latin-regular.woff2") format("woff2"),url("/assets/fonts/fira-code-v8-latin-regular.woff") format("woff"),url("/assets/fonts/fira-code-v8-latin-regular.ttf") format("truetype"),url("/assets/fonts/fira-code-v8-latin-regular.svg#FiraCode") format("svg")}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url("/assets/fonts/fira-code-v8-latin-600.eot");src:local(""),url("/assets/fonts/fira-code-v8-latin-600.eot?#iefix") format("embedded-opentype"),url("/assets/fonts/fira-code-v8-latin-600.woff2") format("woff2"),url("/assets/fonts/fira-code-v8-latin-600.woff") format("woff"),url("/assets/fonts/fira-code-v8-latin-600.ttf") format("truetype"),url("/assets/fonts/fira-code-v8-latin-600.svg#FiraCode") format("svg")}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url("/assets/fonts/fira-code-v8-latin-700.eot");src:local(""),url("/assets/fonts/fira-code-v8-latin-700.eot?#iefix") format("embedded-opentype"),url("/assets/fonts/fira-code-v8-latin-700.woff2") format("woff2"),url("/assets/fonts/fira-code-v8-latin-700.woff") format("woff"),url("/assets/fonts/fira-code-v8-latin-700.ttf") format("truetype"),url("/assets/fonts/fira-code-v8-latin-700.svg#FiraCode") format("svg")}body .intro{font-size:1.25em;line-height:1.7}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,.h5,h6,.h6{margin:.5rem 0 1.5rem;font-family:"Gill Sans",Tahoma,Helvetica,Arial,sans-serif}h1,.h1{font-size:2em;line-height:1.25}@media (min-width: 43.75em){h1,.h1{font-size:2.5em;line-height:1.125}}@media (min-width: 56.25em){h1,.h1{font-size:3em;line-height:1.05}}h2,.h2{font-size:1.625em;line-height:1.15384615}@media (min-width: 43.75em){h2,.h2{font-size:2em;line-height:1.25}}@media (min-width: 56.25em){h2,.h2{font-size:2.25em;line-height:1.25}}h3,.h3{font-size:1.375em;line-height:1.13636364}@media (min-width: 43.75em){h3,.h3{font-size:1.5em;line-height:1.25}}@media (min-width: 56.25em){h3,.h3{font-size:1.75em;line-height:1.25}}h4,.h4{font-size:1.125em;line-height:1.11111111}@media (min-width: 43.75em){h4,.h4{line-height:1.22222222}}.button__outline,.button-tertiary,.button-secondary,.button{background-color:#00649e;display:inline-block;position:relative;font-family:"Gill Sans",Tahoma,Helvetica,Arial,sans-serif;text-decoration:none;color:#fff;font-size:1em;line-height:1.2em;font-weight:normal;padding:.5em 1.5em;border:0;border-radius:4px;cursor:pointer;margin-bottom:.5em;transition:background-color 0.14s ease-in-out}.button__outline:hover,.button-tertiary:hover,.button-secondary:hover,.button:hover,.button__outline:focus,.button-tertiary:focus,.button-secondary:focus,.button:focus{color:#fff;text-decoration:none;background-color:#00446b}.button__outline:active,.button-tertiary:active,.button-secondary:active,.button:active{top:1px}.button-secondary{background-color:#008bd8}.button-secondary:hover{background-color:#006aa5}.button-tertiary{background-color:#aaa}.button-tertiary:hover{background-color:#919191}.button__outline{background-color:transparent;border:3px solid #00649e;color:#00649e}.button__outline:hover{background-color:#00649e;color:#fff}label{display:block;margin-bottom:5px}input[type=text],input[type=email],input[type=phone],input[type=password],input[type=number],input[type=search],textarea{background:#e6e6e6;padding:5px;outline:none;border:none;height:44px;width:300px;margin-bottom:.5rem;font-size:100%}input[type=text]:focus,input[type=email]:focus,input[type=phone]:focus,input[type=password]:focus,input[type=number]:focus,input[type=search]:focus,textarea:focus{border:1px solid #00649e}input.full-width[type=text],input.full-width[type=email],input.full-width[type=phone],input.full-width[type=password],input.full-width[type=number],input.full-width[type=search],textarea.full-width{width:100%}textarea{height:132px}form{margin-bottom:40px}form .field{margin-bottom:20px}form label{color:#666}form .note-warning{margin-top:5px;color:#aaa}form .req{font-style:italic}form .asterisk{color:darkred}form .error .reason{margin-top:5px;color:#FF4136}form .error input[type=text],form .error input[type=email],form .error input[type=phone],form .error input[type=password],form .error input[type=number],form .error input[type=search],form .error textarea{border-color:#FF4136}table{width:100%;border:1px solid #d0d0d0;margin-bottom:1.5em}table caption{margin:0 0 7px;font-size:0.75em;color:#aaa;text-transform:uppercase;letter-spacing:1px}tr{border-bottom:1px solid #d0d0d0}tr:nth-child(even){background-color:#f7f7f7}td{padding:7px;border-right:1px solid #d0d0d0}td:last-child{border-right:0}th{background-color:#f7f7f7;border-bottom:1px solid #d0d0d0;border-right:1px solid #d0d0d0}th:last-child{border-right:0}.highlight{color:#333;background:#f0f0f0;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #bbb;border-radius:4px;padding:10px 0;line-height:1.3;font-size:.9em}code.highlighter-rouge{background-color:rgba(27,31,35,0.05);padding:.2em .4em;margin:0;font-size:85%;border-radius:3px}div.formula-code{color:#333;background:#f0f0f0;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #bbb;border-radius:4px;padding:10px 0;margin:0 0 20px 0}div.formula-code .MathJax_Display{margin:0 !important}.highlight .hll{background-color:#ffc}.highlight .c{color:#999}.highlight .err{color:#a00;background-color:#faa}.highlight .k{color:#069}.highlight .o{color:#555}.highlight .cm{color:#09f;font-style:italic}.highlight .cp{color:#099}.highlight .c1{color:#999}.highlight .cs{color:#999}.highlight .gd{background-color:#fcc;border:1px solid #c00}.highlight .ge{font-style:italic}.highlight .gr{color:#f00}.highlight .gh{color:#030}.highlight .gi{background-color:#cfc;border:1px solid #0c0}.highlight .go{color:#aaa}.highlight .gp{color:#009}.highlight .gu{color:#030}.highlight .gt{color:#9c6}.highlight .kc{color:#069}.highlight .kd{color:#069}.highlight .kn{color:#069}.highlight .kp{color:#069}.highlight .kr{color:#069}.highlight .kt{color:#078}.highlight .m{color:#f60}.highlight .s{color:#d44950}.highlight .na{color:#4f9fcf}.highlight .nb{color:#366}.highlight .nc{color:#0a8}.highlight .no{color:#360}.highlight .nd{color:#99f}.highlight .ni{color:#999}.highlight .ne{color:#c00}.highlight .nf{color:#c0f}.highlight .nl{color:#99f}.highlight .nn{color:#0cf}.highlight .nt{color:#2f6f9f}.highlight .nv{color:#033}.highlight .ow{color:#000}.highlight .w{color:#bbb}.highlight .mf{color:#f60}.highlight .mh{color:#f60}.highlight .mi{color:#f60}.highlight .mo{color:#f60}.highlight .sb{color:#c30}.highlight .sc{color:#c30}.highlight .sd{color:#c30;font-style:italic}.highlight .s2{color:#c30}.highlight .se{color:#c30}.highlight .sh{color:#c30}.highlight .si{color:#a00}.highlight .sx{color:#c30}.highlight .sr{color:#3aa}.highlight .s1{color:#c30}.highlight .ss{color:#fc3}.highlight .bp{color:#366}.highlight .vc{color:#033}.highlight .vg{color:#033}.highlight .vi{color:#033}.highlight .il{color:#f60}#isso-thread *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#isso-thread .isso-comment-header a{text-decoration:none}#isso-thread{padding:0;margin:0}#isso-thread>h4{color:#555;font-weight:bold}#isso-thread>.isso-feedlink{float:right;padding-left:1em}#isso-thread>.isso-feedlink>a{font-size:0.8em;vertical-align:bottom}#isso-thread .textarea{min-height:58px;outline:0}#isso-thread .textarea.placeholder{color:#757575}#isso-root .isso-comment{max-width:68em;padding-top:0.95em;margin:0.95em auto;overflow:auto}#isso-root .preview .isso-comment{padding-top:0;margin:0}#isso-root .isso-comment:not(:first-of-type),.isso-follow-up .isso-comment{border-top:1px solid rgba(0,0,0,0.1)}.isso-comment>div.avatar{display:block;float:left;width:7%;margin:3px 15px 0 0}.isso-comment>div.avatar>svg{max-width:48px;max-height:48px;border:1px solid rgba(0,0,0,0.2);border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,0.1)}.isso-comment>div.text-wrapper{display:block}.isso-comment .isso-follow-up{padding-left:calc(7% + 20px)}.isso-comment>div.text-wrapper>.isso-comment-header,.isso-comment>div.text-wrapper>.isso-comment-footer{font-size:0.95em}.isso-comment>div.text-wrapper>.isso-comment-header{font-size:0.85em}.isso-comment>div.text-wrapper>.isso-comment-header .spacer{padding:0 6px}.isso-comment>div.text-wrapper>.isso-comment-header .spacer,.isso-comment>div.text-wrapper>.isso-comment-header a.permalink,.isso-comment>div.text-wrapper>.isso-comment-header .note,.isso-comment>div.text-wrapper>.isso-comment-header a.parent{color:gray !important;font-weight:normal;text-shadow:none !important}.isso-comment>div.text-wrapper>.isso-comment-header .spacer:hover,.isso-comment>div.text-wrapper>.isso-comment-header a.permalink:hover,.isso-comment>div.text-wrapper>.isso-comment-header .note:hover,.isso-comment>div.text-wrapper>.isso-comment-header a.parent:hover{color:#606060 !important}.isso-comment>div.text-wrapper>.isso-comment-header .note{float:right}.isso-comment>div.text-wrapper>.isso-comment-header .author{font-weight:bold;color:#555}.isso-comment>div.text-wrapper>.textarea-wrapper .textarea,.isso-comment>div.text-wrapper>.textarea-wrapper .preview{margin-top:0.2em}.isso-comment>div.text-wrapper>div.text p{margin-top:0.2em}.isso-comment>div.text-wrapper>div.text p:last-child{margin-bottom:0.2em}.isso-comment>div.text-wrapper>div.text h1,.isso-comment>div.text-wrapper>div.text h2,.isso-comment>div.text-wrapper>div.text h3,.isso-comment>div.text-wrapper>div.text h4,.isso-comment>div.text-wrapper>div.text h5,.isso-comment>div.text-wrapper>div.text h6{font-size:130%;font-weight:bold}.isso-comment>div.text-wrapper>div.textarea-wrapper .textarea,.isso-comment>div.text-wrapper>div.textarea-wrapper .preview{width:100%;border:1px solid #f0f0f0;border-radius:2px;box-shadow:0 0 2px #888}.isso-comment>div.text-wrapper>.isso-comment-footer{font-size:0.80em;color:gray !important;clear:left}.isso-feedlink,.isso-comment>div.text-wrapper>.isso-comment-footer a{font-weight:bold;text-decoration:none}.isso-feedlink:hover,.isso-comment>div.text-wrapper>.isso-comment-footer a:hover{color:#111111 !important;text-shadow:#aaaaaa 0 0 1px !important}.isso-comment>div.text-wrapper>.isso-comment-footer>a{position:relative;top:.2em}.isso-comment>div.text-wrapper>.isso-comment-footer>a+a{padding-left:1em}.isso-comment>div.text-wrapper>.isso-comment-footer .votes{color:gray}.isso-comment>div.text-wrapper>.isso-comment-footer .upvote svg,.isso-comment>div.text-wrapper>.isso-comment-footer .downvote svg{position:relative;top:.2em}.isso-comment .isso-postbox{margin-top:0.8em}.isso-comment.isso-no-votes>*>.isso-comment-footer span.votes{display:none}.isso-postbox{max-width:68em;margin:0 auto 2em;clear:right}.isso-postbox>.form-wrapper{display:block;padding:0}.isso-postbox>.form-wrapper>.auth-section,.isso-postbox>.form-wrapper>.auth-section .post-action{display:block}.isso-postbox>.form-wrapper .textarea,.isso-postbox>.form-wrapper .preview{margin:0 0 .3em;padding:.4em .8em;border-radius:3px;background-color:#fff;border:1px solid rgba(0,0,0,0.2);box-shadow:0 1px 2px rgba(0,0,0,0.1)}.isso-postbox>.form-wrapper input[type=checkbox]{vertical-align:middle;position:relative;bottom:1px;margin-left:0}.isso-postbox>.form-wrapper .notification-section{font-size:0.90em;padding-top:.3em}#isso-thread .textarea:focus,#isso-thread input:focus{border-color:rgba(0,0,0,0.8)}.isso-postbox>.form-wrapper>.auth-section .input-wrapper{display:inline-block;position:relative;max-width:25%;margin:0}.isso-postbox>.form-wrapper>.auth-section .input-wrapper input{padding:.3em 10px;max-width:100%;border-radius:3px;background-color:#fff;line-height:1.4em;border:1px solid rgba(0,0,0,0.2);box-shadow:0 1px 2px rgba(0,0,0,0.1)}.isso-postbox>.form-wrapper>.auth-section .post-action{display:inline-block;float:right;margin:0 0 0 5px}.isso-postbox>.form-wrapper>.auth-section .post-action>input{padding:calc(.3em - 1px);border-radius:2px;border:1px solid #CCC;background-color:#DDD;cursor:pointer;outline:0;line-height:1.4em;box-shadow:0 1px 2px rgba(0,0,0,0.1)}.isso-postbox>.form-wrapper>.auth-section .post-action>input:hover{background-color:#CCC}.isso-postbox>.form-wrapper>.auth-section .post-action>input:active{background-color:#BBB}.isso-postbox>.form-wrapper .preview,.isso-postbox>.form-wrapper input[name="edit"],.isso-postbox.preview-mode>.form-wrapper input[name="preview"],.isso-postbox.preview-mode>.form-wrapper .textarea{display:none}.isso-postbox.preview-mode>.form-wrapper .preview{display:block}.isso-postbox.preview-mode>.form-wrapper input[name="edit"]{display:inline}.isso-postbox>.form-wrapper .preview{background-color:#f8f8f8;background:repeating-linear-gradient(-45deg, #f8f8f8, #f8f8f8 10px, #fff 10px, #fff 20px)}.isso-postbox>.form-wrapper>.notification-section{display:none;padding-bottom:10px}@media screen and (max-width: 600px){.isso-postbox>.form-wrapper>.auth-section .input-wrapper{display:block;max-width:100%;margin:0 0 .3em}.isso-postbox>.form-wrapper>.auth-section .input-wrapper input{width:100%}}html.dark-reader body{background-image:none}html.dark-reader body .footer{background-image:none}html{box-sizing:border-box;background-color:#fefefe}*,*:before,*:after{box-sizing:inherit}body{background-color:#fff;background-image:url("/assets/media/tile-graphpaper.png");font-family:Georgia,Times,serif;line-height:1.75;font-size:112.5%;color:#111;overflow-x:hidden;margin:0}body p,body ul{margin:0 0 2rem}body code{font-family:"Fira Code",monospace,monospace;font-variant-ligatures:common-ligatures}::-moz-selection{background:#00649e;color:white}::selection{background:#00649e;color:white}img,video,audio,iframe,object{max-width:100%;height:auto}.container{max-width:610px;padding:0 20px;margin-left:auto;margin-right:auto}a{color:#00649e}a:hover{color:#003452}.nav-collapse{z-index:1}.nav-collapse ul{margin:0;padding:0;width:100%;display:block;list-style:none}.nav-collapse ul li{width:100%;display:block;background:#57457a;border-bottom:2px solid #675291}.nav-collapse ul li a{color:white;text-decoration:none;display:block;padding:5px 2rem}.nav-collapse{clip:rect(0 0 0 0);max-height:0;position:absolute;display:block;overflow:hidden;transform:scale(1);transform-origin:0 0;clear:both;width:100%}.no-js .nav-collapse{position:relative;max-height:none}.nav-collapse.opened{max-height:9999px}.nav-toggle{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;float:right;line-height:2em;margin-top:.5em;background-color:#00649e;border-radius:4px;padding:0 .5em;color:white;text-decoration:none;position:relative;right:2rem;transition:all 0.2s ease-in-out}.nav-toggle:hover{color:white;background-color:#00446b}.noList{list-style:none;padding-left:0;margin-left:0}dt{font-weight:bold}dd{margin:0 0 1.5rem}.post ul ul,.post ul ol,.post ol ul,.post ol ol{margin:0}.pageTitle{margin:2rem auto 1em;text-align:center}.pageTitle .type{color:#888}.content{padding-top:1em}.js .header{height:3em}.header{background-color:#473864;background-size:cover;background-position:center center;color:white;padding:0}.header .container{padding:0;max-width:100%}.header h1{margin:0;float:left;padding-left:2rem;font-size:1em;line-height:3em;font-family:"Gill Sans",Tahoma,Helvetica,Arial,sans-serif;text-transform:lowercase}.header h1 .wide1,.header h1 .wide2{display:none}.header h1 a{color:#e9d9ff;text-decoration:none;font-family:"Fira Code",monospace,monospace;font-variant-ligatures:common-ligatures;text-shadow:0px 0px 4px #000000}.post .postTitle{text-align:center;margin-top:2rem;margin-bottom:1rem}.post blockquote{clear:both;margin:2.5em 0;padding:0;line-height:1.8;position:relative;font-size:110%}.post blockquote em{color:#444}.post blockquote:before{content:"";position:absolute;top:-1.25em;background:#00649e;display:block;height:2px;width:150px;left:calc(50% - 75px)}.post blockquote:after{content:"";position:absolute;bottom:-1.25em;background:#00649e;display:block;height:2px;width:150px;left:calc(50% - 75px)}.post .meta,.post #article-details{text-align:center;color:gray;font-family:Georgia,Times,serif;font-weight:normal}.post .meta a,.post #article-details a{color:#1d8dcd;text-decoration:none}.post .meta a:hover,.post #article-details a:hover{text-decoration:underline}.post figure{margin:3rem 0}.post figure figcaption{text-align:center;font-size:.9em;font-style:italic;color:#5e5e5e}.post figure img{margin:0 auto;display:block}.post img{border-radius:3px}.post img.left{float:left;margin-right:1em;margin-bottom:1em}.post img.right{float:right;margin-left:1em;margin-bottom:1em}.post .highlight{clear:both;margin-bottom:2rem}.post .dropcap{color:#00649e;margin-right:.45rem}.post .featuredImage{position:relative;margin-top:2rem}.post .featuredImage img{margin-bottom:0}.post #article-details{border-style:solid;border-color:#777;border-width:1.5px 0 0 0;width:100%;text-align:left;margin:0 auto;padding:1rem 0}.post #article-details #all-categories{margin-top:1rem;padding-top:1rem;border-top:1px solid #e6e6e6}.post .snippets ul{margin-top:1rem}.post .snippets ul li time{font-weight:normal;font-size:.9em;color:gray}.post hr{border-style:solid;border-color:#777;border-width:1.5px 0 0 0;margin-top:2rem;margin-bottom:2rem}.post div.footnotes{font-size:85%}.post div.footnotes ol{margin:0;margin-bottom:2rem;width:100%;list-style-position:outside;padding-left:30px}.post div.footnotes li p{margin-left:0;margin-right:0;width:100%}.post.snippet .postTitle{font-size:100%}.post div.related{border-top:1.5px solid #d9d9d9}.post div.related,div.archive_list{width:100%;margin:0 auto}.post div.related h2,div.archive_list h2{margin:0;margin-top:1rem;color:#000}.post div.related div.container,div.archive_list div.container{display:block;margin-top:2rem}.post div.related div.container div.item,div.archive_list div.container div.item{clear:left;margin-bottom:1rem;width:100%}.post div.related div.container div.item div.related-image,div.archive_list div.container div.item div.related-image{display:block;float:right;margin-bottom:1rem;margin-left:1rem;width:42px;height:42px;background-position:center;background-repeat:no-repeat;background-size:cover;background-color:rgba(0,0,0,0.1);border-radius:2px;text-decoration:none;padding:1rem}.post div.related div.container div.item .related-meta,div.archive_list div.container div.item .related-meta{font-family:Georgia,Times,serif;font-weight:normal;font-size:.9em;color:gray;line-height:1.5}.post div.related div.container div.item .related-meta a,div.archive_list div.container div.item .related-meta a{color:#1d8dcd;text-decoration:none}.post div.related div.container div.item .related-meta a:hover,div.archive_list div.container div.item .related-meta a:hover{text-decoration:underline}div.archive_list{position:relative}div.archive_list h3{margin-top:4rem;color:#A66C75}div.archive_list:before{content:"";position:absolute;bottom:-2rem;left:0;background:#e6e6e6;height:2px;width:60px}div.archive_list.last:before{display:none}.postNav{border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;overflow:hidden}.postNav .prev,.postNav .next{display:block;width:100%;height:5rem;overflow:hidden;position:relative;font-family:"Gill Sans",Tahoma,Helvetica,Arial,sans-serif;font-weight:800;font-size:.9em;text-transform:uppercase;text-align:center}.postNav .prev img,.postNav .next img{z-index:1;display:block;position:absolute;top:50%;transform:translateY(-50%);left:0;width:100%;height:auto}.postNav .prev span,.postNav .next span{z-index:10;position:relative;padding:.5rem;position:absolute;top:50%;transform:translateY(-50%);width:100%;line-height:1.4}.postNav .prev.image,.postNav .next.image{text-decoration:none;color:white;text-shadow:1px 1px 3px rgba(0,0,0,0.8);padding:0 .5rem;position:relative;transition:all 0.2s ease-in-out}.postNav .prev.image:hover,.postNav .next.image:hover{opacity:.8}.postNav .prev span{left:0}.postNav .next span{right:0}.footer{margin-top:2rem;clear:both;background:#fafafa}.footer hr{display:block;clear:both;border:1px solid #eaeaea;margin:1rem 0}.footer #footer-comments-widget{border-bottom:2px solid #eaeaea;margin-bottom:1rem}.footer .contributions{padding:1rem 0}.footer .contributions .note-warning{font-size:14px;border:1px solid #e1e4e8;background-color:#f6f8fa;border-radius:3px;padding:16px;font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;margin-bottom:1rem}.footer .contributions .note-warning .extra{color:#586069}.footer .contributions #disqus_thread{max-width:90%;margin:0 auto;overflow:auto}.footer .contributions h2,.footer .contributions h3{margin-top:0;color:#A66C75}.footer .contributions #share{border-bottom:1px solid #C69AA1}.footer .contributions div.isso-comment>.text-wrapper>div.isso-comment-header{display:inline-block;vertical-align:middle}.footer .contributions div.isso-comment>.text-wrapper>div.text{font-size:90%;clear:both}.footer .contributions div.isso-comment>.text-wrapper p{margin:0 0 0.7rem}.footer .contributions div.isso-comment>.text-wrapper blockquote{color:#777;margin:5px 0;padding:5px;padding-left:10px;border-left:4px solid #ddd;background-color:#f7f7f7}.footer .contributions div.isso-comment>.text-wrapper code{color:#333;background:#f0f0f0}.footer .contributions div.isso-comment>.text-wrapper pre{color:#333;background:#f0f0f0;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #bbb;border-radius:4px;padding:10px 0}.footer .contributions div.isso-postbox .textarea,.footer .contributions .notification-section{font-size:90%}.footer .contributions .notification-section input{margin-right:5px}.footer .contributions .avatar img{width:32px;height:32px;border-radius:3px}.footer .contributions input,.footer .contributions textarea{font-size:90%}.footer .contributions #mc_embed_signup form{margin-bottom:0}.footer .bottom{background:#f2f2f2;font-size:.8em;color:#656c7a;border-top:2px solid #eaeaea;border-bottom:2px solid #eaeaea;padding:1rem 0}.footer .bottom .container{max-width:90%;text-align:center}.footer .bottom .container .copy,.footer .bottom .container .links{display:block}.pagination div.page_number{color:gray;border-top:1px dashed #aaa;padding:1rem 0}.pagination .next{float:left}.pagination .previous{float:right}.posts li{margin-bottom:4rem;position:relative}.posts li:before{content:"";position:absolute;bottom:-2rem;left:0;background:#e6e6e6;height:2px;width:60px}.posts li:last-child:before{display:none}.posts li a{text-decoration:none}.posts li a:hover{text-decoration:underline}.posts li .meta{font-family:Georgia,Times,serif;font-weight:normal;font-size:.9em;color:gray}.posts li .meta time{display:block}.posts li .meta a{color:#1d8dcd;text-decoration:none}.posts li .meta a:hover{text-decoration:underline}.posts li h3{margin:0 0 .5em}#home{padding-top:2em}#home .postTitle{text-align:center}img.right{float:none}.patreon-button img{width:170px;height:40px}.post.about img.avatar{width:100px}.small-note{font-size:80%;color:gray}.video .youtube-play-link{position:relative;display:block;box-shadow:0px 0px 5px 0px rgba(50,50,50,0.3);border-radius:3px}.video .youtube-play-link:before{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-webkit-transform:translate(-50%, -50%);display:block;width:80px;height:56px;font-size:1px;content:" ";opacity:.8;z-index:100;background-image:url(/assets/media/youtube.png);background-size:80px 56px;background-position:center;background-repeat:no-repeat;transition-timing-function:ease-in;transition:opacity 0.3s}.video .youtube-play-link:hover:before{opacity:1}.video .youtube-play-link img.play-thumb{display:block;min-height:70px}.video .video-container{position:relative;padding-bottom:56.25%;padding-top:10px;height:0;overflow:hidden}.video .video-container iframe,.video .video-container object,.video .video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}.no-js .only-js{display:none}.no-js .video .video-container{display:none}.posts img{border-radius:3px}.posts figure{margin:1rem 0}.posts figure figcaption{text-align:center;font-size:.9em;font-style:italic;color:#5e5e5e}.posts figure img{margin:0 auto;display:block}.hidden{display:none}.post header nav.toc{border-top:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;margin-bottom:1rem}.post header nav.toc ul{margin-bottom:1rem}.post header nav.toc .toc-title{font-weight:bold;margin:1rem auto 1rem}.post .warn-bubble,.post .info-bubble,.post.privacy_policy #opt_out_frame iframe{background-color:rgba(226,231,240,0.3);color:#555;padding:7px;border:2px dashed #e2f0e7;border-radius:10px}.post .warn-bubble{color:#655;background-color:rgba(243,235,237,0.3);border:2px dashed #f6ddd7}.post .highlight{line-height:1.2;border-radius:0}.post .highlight pre.code{margin:0 auto;padding:0 5px;width:100%}.post .formula-code,.post .highlight>pre.code>code{font-size:90%}.post.privacy_policy #opt_out_frame iframe{width:100%;height:300px}h1,h2,h3,h4,h5,h6{color:#111;font-weight:700}h1 a.anchor,h2 a.anchor,h3 a.anchor,h4 a.anchor,h5 a.anchor,h6 a.anchor{color:lightgray;font-weight:normal;text-decoration:none}h1 a.anchor:hover,h2 a.anchor:hover,h3 a.anchor:hover,h4 a.anchor:hover,h5 a.anchor:hover,h6 a.anchor:hover{color:gray}.nobr{white-space:nowrap}.clearfix{transform:scale(1);transform-origin:0 0}.clearfix:before,.clearfix:after{content:"\0020";display:block;height:0;overflow:hidden}.clearfix:after{clear:both}@media only screen and (min-width: 375px){.header h1 .wide1{display:inline}}@media only screen and (min-width: 500px){.header h1 .wide1,.header h1 .wide2{display:inline}.post.privacy_policy #opt_out_frame iframe{height:260px}}@media only screen and (min-width: 800px){body{font-size:125%}.content{padding-top:0;position:relative;z-index:1}.container{max-width:880px;margin-left:auto;margin-right:auto;padding:0}#home .posts,#home .pageTitle,#home .pagination,#home .archive_list{width:75%;float:none;margin:0 auto 1.5em}#home .pageTitle{margin:2rem auto 1em}.js .header,.no-js .header{height:7em;position:relative;padding-bottom:0}.js .header .wide1,.js .header .wide2,.no-js .header .wide1,.no-js .header .wide2{display:inline}.js .header .container,.no-js .header .container{position:relative;top:50%;transform:translateY(-50%);max-width:880px;overflow:hidden}.js .header .container .inner-container,.no-js .header .container .inner-container{width:75%;margin:0 auto}.js .header h1,.no-js .header h1{font-size:2em;line-height:1;padding-left:0}.js .header nav,.no-js .header nav{float:left;clear:left}.js .header nav ul,.no-js .header nav ul{margin:0}.js .header nav ul li,.no-js .header nav ul li{display:inline;line-height:3em;background:none;padding:0 5px;border:none}.js .header nav ul li a,.no-js .header nav ul li a{color:white;font-size:0.9em;text-decoration:none;padding:0 0.25em}.js .header nav ul li a:hover,.no-js .header nav ul li a:hover{color:#ccc}.js .header nav ul li.current,.no-js .header nav ul li.current{padding-bottom:0.25em;border-bottom:4px solid rgba(255,255,255,0.4)}.nav-collapse{position:relative;max-height:none}.nav-collapse.closed{max-height:none}.nav-collapse ul li a{display:inline-block}.nav-toggle{display:none}.post h1,.post h2,.post h3,.post h4,.post h5,.post h6,.post p,.post ul,.post ol,.post dl,.post .pageTitle,.post .content,.post .page-width,.post div.footnotes{width:75%;float:none;margin:0 auto 2rem}.post hr{width:75%}.post div.footnotes{margin:0 auto 1rem}.post div.footnotes p{margin-bottom:1rem}.post h1,.post .h1,.post h2,.post .h2,.post h3,.post .h3,.post h4,.post .h4,.post h5,.post .h5,.post h6,.post .h6{margin:1rem auto}.post .pageTitle{margin:2rem auto 1em}.post .featuredImage{position:relative;margin-top:2rem}.post .highlight{font-size:0.8em;padding:20px}.post div.formula-code{padding:20px 10px}.post blockquote{font-size:120%;padding:0}.post.snippet .postTitle{font-size:120%}.postNav .prev,.postNav .next{width:50%}.postNav .prev{float:left;text-align:left}.postNav .next{text-align:right;float:right}.footer .container{max-width:880px}.footer .contributions{width:75%;margin:0 auto}.footer .contributions .avatar img{width:48px;height:48px;border-radius:5px}.footer .bottom .container .copy::after{content:"|"}.footer .bottom .container .copy,.footer .bottom .container .links{display:inline}.contactContent{max-width:48%;margin-right:2%;float:left}#contact form{max-width:48%;width:48%;float:right;margin-right:0}img.right{float:right}.post.about img.avatar{width:300px}div.header nav{text-shadow:0px 0px 4px #000000}#abonament form{width:75%;margin:0 auto 2rem}.post div.related{width:75%}.post #article-details{width:75%}.post .formula-code,.post .highlight>pre.code>code{font-size:100%}.post.privacy_policy #opt_out_frame iframe{height:190px}.video .youtube-play-link:before{width:120px;height:84px;background-size:120px 84px}}@media only screen and (min-width: 1200px){body{font-size:137.5%}.container{max-width:990px}.container .inner-container{width:75%;margin:0 auto}.js .header .container,.no-js .header .container{max-width:990px}.post .formula-code,.post .highlight>pre.code>code{font-size:110%}.post.privacy_policy #opt_out_frame iframe{height:180px}.footer .container{max-width:990px}.footer .contributions #disqus_thread{max-width:1000px}.post.snippet .postTitle{font-size:140%}}@media (prefers-color-scheme: dark){:root{color-scheme:light dark}html,body,*{scrollbar-width:thin;scrollbar-color:#727173 #1e2223}body::-webkit-scrollbar,*::-webkit-scrollbar{width:10px}body::-webkit-scrollbar-track,*::-webkit-scrollbar-track{background:#1e2223}body::-webkit-scrollbar-thumb,*::-webkit-scrollbar-thumb{background-color:#727173;border-radius:6px;border:3px solid #1e2223}html{background-color:#171a1b;background-image:none}body{background-color:#171a1b;background-image:none;color:#dddad6}body a{color:#00c1ff}body a:hover{color:#0087b3}body .header{background-color:#473864}body h1,body h2,body h3,body h4,body h5,body h6{color:#dddad6}body .highlight{background:#11202c;color:#fefffe;border:1px solid #333}body div.formula-code{background:#11202c;color:#fefffe;border:1px solid #333}body code.language-plaintext.highlighter-rouge{background-color:#1e2325}body form label{color:#777}body form select,body form input,body form textarea,body form button,body form .textarea,body form input[type="text"],body form input[type="email"],body form input[type="phone"],body form input[type="password"],body form input[type="number"],body form input[type="search"]{border:1px solid #1a1a1a;color:#afafaf;background:#242424;transition:background-color 0.3s cubic-bezier(0.57, 0.21, 0.69, 1.25), transform 0.3s cubic-bezier(0.57, 0.21, 0.69, 1.25)}body form button,body form input[type="submit"],body form input[type="button"],body form input[type="reset"]{border:1px solid #262626;background:#333}body form ::placeholder{color:inherit;opacity:1}body .post header nav.toc{border-color:#3b4042}body .post .info-bubble{background-color:#25313c;border-color:#384b5c;color:#dddad6}body .post .info-bubble code.language-plaintext.highlighter-rouge{background-color:#2f3e4c}body .post .warn-bubble{background-color:#362521;border-color:#563b34;color:inherit}body .post .warn-bubble code.language-plaintext.highlighter-rouge{background-color:#46302b}body .post hr{border-color:#dddad6}body .post #article-details{border-color:#dddad6}body .post #article-details #all-categories{border-color:#3a4244}body .post div.related{border-color:#3a4244}body .post .meta,body .post #article-details{color:#778899}body .post .dropcap{color:#00c1ff}body .post blockquote em{color:#bab4ac}body .post .transparency-fix{background-color:#6f8288}body .button-secondary{background-color:#0ca8ff}body .button-secondary:hover{background-color:#008bd8}body a.button__outline{border:3px solid #00c1ff;color:#00c1ff}body a.button__outline:hover{background-color:#00c1ff;color:#fff}body .post div.related div.container div.item .related-meta,body div.archive_list div.container div.item .related-meta{color:#778899}body .post div.related h2,body div.archive_list h2{color:#dddad6}body .footer{background-color:#232729;background-image:none}body .footer .contributions #isso-thread label{color:#777}body .footer .contributions #isso-thread select,body .footer .contributions #isso-thread input,body .footer .contributions #isso-thread textarea,body .footer .contributions #isso-thread button,body .footer .contributions #isso-thread .textarea,body .footer .contributions #isso-thread input[type="text"],body .footer .contributions #isso-thread input[type="email"],body .footer .contributions #isso-thread input[type="phone"],body .footer .contributions #isso-thread input[type="password"],body .footer .contributions #isso-thread input[type="number"],body .footer .contributions #isso-thread input[type="search"]{border:1px solid #1a1a1a;color:#afafaf;background:#242424;transition:background-color 0.3s cubic-bezier(0.57, 0.21, 0.69, 1.25), transform 0.3s cubic-bezier(0.57, 0.21, 0.69, 1.25)}body .footer .contributions #isso-thread button,body .footer .contributions #isso-thread input[type="submit"],body .footer .contributions #isso-thread input[type="button"],body .footer .contributions #isso-thread input[type="reset"]{border:1px solid #262626;background:#333}body .footer .contributions #isso-thread ::placeholder{color:inherit;opacity:1}body .footer .contributions #isso-thread>h4{color:#8695a4}body .footer .contributions #isso-thread .isso-comment>div.text-wrapper>.isso-comment-header{color:#778899}body .footer .contributions #isso-thread .isso-comment>div.text-wrapper>.isso-comment-header .author{color:#8695a4}body .footer .contributions #isso-thread .isso-comment>.text-wrapper blockquote{border-left-color:#3a3e41;background-color:#1d1f20;color:#9d9488}body .footer .contributions #isso-thread .isso-comment>.text-wrapper code{background:#11202c;color:#fefffe}body .footer .contributions #isso-thread .isso-comment>.text-wrapper pre{background:#11202c;color:#fefffe;border:1px solid #333}body .footer .contributions .note-warning{border:1px solid #171a1b;background-color:#1e2223}body .footer .contributions .note-warning .extra{color:#586069}body .footer .bottom{background:#171a1b;color:lightslategray;border-top:2px solid #232729;border-bottom:2px solid #232729}body .footer #footer-comments-widget{border-bottom:2px solid #464f52}body div.archive_list:before,body .posts li:before{background:#3a4244}.video .youtube-play-link{box-shadow:0px 0px 5px 0px rgba(200,200,200,0.3)}.highlight .c{color:#75715e}.highlight .err{color:#960050;background-color:#1e0010}.highlight .k{color:#66d9ef}.highlight .l{color:#ae81ff}.highlight .n{color:#f8f8f2}.highlight .o{color:#f92672}.highlight .p{color:#f8f8f2}.highlight .cm{color:#75715e}.highlight .cp{color:#75715e}.highlight .c1{color:#75715e}.highlight .cs{color:#75715e}.highlight .ge{font-style:italic}.highlight .gs{font-weight:bold}.highlight .kc{color:#66d9ef}.highlight .kd{color:#66d9ef}.highlight .kn{color:#f92672}.highlight .kp{color:#66d9ef}.highlight .kr{color:#66d9ef}.highlight .kt{color:#66d9ef}.highlight .ld{color:#e6db74}.highlight .m{color:#ae81ff}.highlight .s{color:#e6db74}.highlight .na{color:#a6e22e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#a6e22e}.highlight .no{color:#66d9ef}.highlight .nd{color:#a6e22e}.highlight .ni{color:#f8f8f2}.highlight .ne{color:#a6e22e}.highlight .nf{color:#a6e22e}.highlight .nl{color:#f8f8f2}.highlight .nn{color:#f8f8f2}.highlight .nx{color:#a6e22e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f92672}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f92672}.highlight .w{color:#f8f8f2}.highlight .mf{color:#ae81ff}.highlight .mh{color:#ae81ff}.highlight .mi{color:#ae81ff}.highlight .mo{color:#ae81ff}.highlight .sb{color:#e6db74}.highlight .sc{color:#e6db74}.highlight .sd{color:#e6db74}.highlight .s2{color:#e6db74}.highlight .se{color:#ae81ff}.highlight .sh{color:#e6db74}.highlight .si{color:#e6db74}.highlight .sx{color:#e6db74}.highlight .sr{color:#e6db74}.highlight .s1{color:#e6db74}.highlight .ss{color:#e6db74}.highlight .bp{color:#f8f8f2}.highlight .vc{color:#f8f8f2}.highlight .vg{color:#f8f8f2}.highlight .vi{color:#f8f8f2}.highlight .il{color:#ae81ff}.highlight .gu{color:#75715e}.highlight .gd{color:#f92672}.highlight .gi{color:#a6e22e}}

    </style>
</head>


<body>
   <div class="header">
  <div class="container">
    <div class="inner-container">
      <h1 class="logo"><a href="/">Alex<span class="wide2">andru</span> Nedelcu<span class="wide1"> =&lt;&lt;</span></a></h1>
      <nav class="nav-collapse">
        <ul class="noList">
          
          <li class="element first current ">
            <a href="/blog/">Blog</a>
          </li>
          
          <li class="element   ">
            <a href="/wiki/">Wiki</a>
          </li>
          
          <li class="element   ">
            <a href="/about/">About</a>
          </li>
          
          <li class="element   last">
            <a href="/subscribe/">Subscribe</a>
          </li>
          
        </ul>
      </nav>  
    </div>
  </div>
</div><!-- end .header -->


   <div class="content">
      <div class="container">
         <article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header>
      <h1 class="postTitle" itemprop="headline">
        
        
          
      Towards a Better AtomicReference
    
        
        
      </h1>
    
    <p class="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2013/05/07/towards-better-atomicreference-scala/"/>
      <meta itemprop="datePublished" content="2013-05-07T00:00:00+0000"/>
      
      <time itemprop="dateCreated" datetime="2013-05-07T00:00:00+0000">May 7, 2013</time>
      | <span class="nobr"><span class="time">10</span> minutes</span>
      
      | <a href="/blog/2013/05/07/towards-better-atomicreference-scala/#isso-thread" class="nobr">comments</a>
      
    </p>

    

    <div class="hidden" itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
      <meta itemprop="name" content="Alexandru Nedelcu">
      <meta itemprop="url" content="https://alexn.org/about/">
      <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
        <meta itemprop="url" content="https://alexn.org/assets/raw/logo-green.png">
      </div>
    </div>
    <div class="hidden" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Alexandru Nedelcu" />
        <meta itemprop="url" content="https://alexn.org/about/#alexelcu" />
        <meta itemprop="url" content="https://twitter.com/alexelcu" />
        <meta itemprop="url" content="https://github.com/alexandru" />
      </div>
    

    </header>

  <div id="content" itemprop="articleBody">
    <p class="intro withcap">
  The
  <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/atomic/package-summary.html">AtomicReference</a>
  is like a container for a <code class="language-plaintext highlighter-rouge">volatile</code> reference. Usage of <code class="language-plaintext highlighter-rouge">volatile</code>
  references is useful for the issue of
  <a href="/blog/2013/03/14/jvm-multithreading-monitor-locks-visibility.html#visibility">visibility</a>
  in concurrent code, however <code class="language-plaintext highlighter-rouge">AtomicReference</code> also supports the atomic
  <a href="http://en.wikipedia.org/wiki/Compare-and-swap">Compare-and-Swap</a>
  operation (CAS for short), which is the pillar of all non-blocking
  data-structures and algorithms built on top of the JVM, including
  complex ones like the <code class="language-plaintext highlighter-rouge">ConcurrentLinkedQueue</code>, an implementation based
  on the
  <a href="http://www.cs.rochester.edu/u/michael/PODC96.html">Michael-Scott non-blocking queues</a>.
</p>

<p>However, the interface provided leaves something to be desired:</p>

<ul>
  <li>the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicReference.html#compareAndSet%28V,%20V%29">compareAndSet</a>
operation is too low level and for 99% of everything we do in our day to day
code it can be replaced with something much better, as we’ll see</li>
  <li>the classes from the <code class="language-plaintext highlighter-rouge">java.util.concurrent.atomic</code> package do not
implement a common interface, so you can’t use an
<a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicInteger.html">AtomicInteger</a>
in place of an <code class="language-plaintext highlighter-rouge">AtomicReference</code></li>
  <li><code class="language-plaintext highlighter-rouge">AtomicInteger</code> and <code class="language-plaintext highlighter-rouge">AtomicLong</code> provide <code class="language-plaintext highlighter-rouge">incrementAndGet</code>, which is
really useful in practice for keeping track of things in
non-blocking counters, but why should that be available only for
Ints and Longs?  Floats, Doubles, BigInt, BigDecimal and all kinds
of numbers can be incremented too</li>
</ul>

<p><strong>IMPORTANT UPDATE (March 31, 2014):</strong> The content of this article is slightly obsolete, though
still has pedagogical value. For an up to date article on my Atomic references, checkout the wiki page maintained for project <a href="https://github.com/alexandru/monifu/">Monifu</a>: <a href="https://github.com/alexandru/monifu/blob/master/docs/atomic.md">Atomic References</a></p>

<!-- read more -->

<p>This is a simple and working example of how Scala can improve your
code tremendously. And I’m basically describing the implementation of
my own <code class="language-plaintext highlighter-rouge">shifter.concurrency.atomic.Ref</code>. You can:</p>

<ul>
  <li>see the code in <a href="https://github.com/alexandru/shifter/blob/master/core/src/main/scala/shifter/concurrency/atomic/Ref.scala">my GitHub repo</a></li>
  <li>checkout the <a href="http://shifter.alexn.org/api/current/core/#shifter.concurrency.atomic.package">API docs</a></li>
</ul>
      <h2 id="the-common-interface">
        
        
          The Common Interface <a href="#the-common-interface" class="anchor">#</a>
        
        
      </h2>
    

<p>Lets start by mirroring the basics of AtomicReference:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">trait</span> <span class="nc">Ref</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">get</span><span class="k">:</span> <span class="kt">T</span>
  <span class="k">def</span> <span class="nf">set</span><span class="o">(</span><span class="n">update</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="n">expect</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">update</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Ref</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">apply</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">initial</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RefAny</span><span class="o">(</span><span class="n">initial</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>With a generic implementation that for now just delegates to our inner
<code class="language-plaintext highlighter-rouge">AtomicReference</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">class</span> <span class="nc">RefAny</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">initial</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Ref</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">get</span> <span class="k">=</span> 
    <span class="nv">instance</span><span class="o">.</span><span class="py">get</span><span class="o">()</span>  
  <span class="k">def</span> <span class="nf">set</span><span class="o">(</span><span class="n">update</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> 
    <span class="nv">instance</span><span class="o">.</span><span class="py">set</span><span class="o">(</span><span class="n">update</span><span class="o">)</span>  
  <span class="k">def</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="n">expect</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">update</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> 
    <span class="nv">instance</span><span class="o">.</span><span class="py">compareAndSet</span><span class="o">(</span><span class="n">expect</span><span class="o">,</span> <span class="n">update</span><span class="o">)</span>
	
  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">val</span> <span class="nv">instance</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AtomicReference</span><span class="o">(</span><span class="n">initial</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As I was saying, the <code class="language-plaintext highlighter-rouge">compareAndSet</code> is too low level. Much better is
to work with transformations. How about defining a function with the
following signature:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">def</span> <span class="nf">transformAndGet</span><span class="o">(</span><span class="n">cb</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="n">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span>
</code></pre></div></div>

<p>And that can be used like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">val</span> <span class="nv">ref</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>

<span class="nv">ref</span><span class="o">.</span><span class="py">transformAndGet</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">)</span>
<span class="c1">// =&gt; 4</span>
</code></pre></div></div>

<p>Well, incrementing numbers is not the only thing that you can do. For
instance you could store and transform immutable data-structures, like a queue:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">import</span> <span class="nn">collection.immutable.Queue</span>

<span class="k">val</span> <span class="nv">ref</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="nv">Queue</span><span class="o">.</span><span class="py">empty</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

<span class="nv">ref</span><span class="o">.</span><span class="py">transformAndGet</span><span class="o">(</span><span class="n">q</span> <span class="k">=&gt;</span> <span class="nv">q</span><span class="o">.</span><span class="py">enqueue</span><span class="o">(</span><span class="s">"Alex"</span><span class="o">))</span>
</code></pre></div></div>

<p>How about that? We got ourselves a non-blocking queue, without having
to implement the dreadful Michael-Scott algorithm.</p>

<p>Implementing <code class="language-plaintext highlighter-rouge">Ref.transformAndGet</code> is easy:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code>  <span class="nd">@tailrec</span>
  <span class="k">final</span> <span class="k">def</span> <span class="nf">transformAndGet</span><span class="o">(</span><span class="n">cb</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="n">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">oldValue</span> <span class="k">=</span> <span class="n">get</span>
    <span class="k">val</span> <span class="nv">newValue</span> <span class="k">=</span> <span class="nf">cb</span><span class="o">(</span><span class="n">oldValue</span><span class="o">)</span>

    <span class="nf">if</span> <span class="o">(!</span><span class="nf">compareAndSet</span><span class="o">(</span><span class="n">oldValue</span><span class="o">,</span> <span class="n">newValue</span><span class="o">))</span>
	  <span class="c1">// tail-recursive call</span>
      <span class="nf">transformAndGet</span><span class="o">(</span><span class="n">cb</span><span class="o">)</span>
    <span class="k">else</span>
      <span class="n">newValue</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>I’m using a tail-recursive function, guarded by the <code class="language-plaintext highlighter-rouge">tailrec</code>
annotation, because that’s how I roll. I also find it much more
readable and less error-prone. It creates a loop … as long as the
<code class="language-plaintext highlighter-rouge">compareAndSet</code> operation is unsuccessful, then it keeps trying.</p>

<p>We can also implement <code class="language-plaintext highlighter-rouge">Ref.getAndTransform</code>, which returns the old
value before the transformation occurred, instead of the update:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code>  <span class="nd">@tailrec</span>
  <span class="k">final</span> <span class="k">def</span> <span class="nf">getAndTransform</span><span class="o">(</span><span class="n">cb</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="n">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">oldValue</span> <span class="k">=</span> <span class="n">get</span>
    <span class="k">val</span> <span class="nv">update</span> <span class="k">=</span> <span class="nf">cb</span><span class="o">(</span><span class="n">oldValue</span><span class="o">)</span>

    <span class="nf">if</span> <span class="o">(!</span><span class="nf">compareAndSet</span><span class="o">(</span><span class="n">oldValue</span><span class="o">,</span> <span class="n">update</span><span class="o">))</span>
	  <span class="c1">// tail-recursive call</span>
      <span class="nf">getAndTransform</span><span class="o">(</span><span class="n">cb</span><span class="o">)</span>
    <span class="k">else</span>
      <span class="n">oldValue</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>We can have other utilities too, like
<a href="http://shifter.alexn.org/api/current/core/index.html#shifter.concurrency.atomic.Ref@transformAndExtract[U]%28cb:T=%3E%28T,U%29%29:U">transformAndExtract</a>,
but lets move on to our next issue … incrementing numbers.</p>

<p>Of course, with our transformation functions, the presence of a
shortcut for incrementing numbers is not that required anymore,
however it’s still a nice shortcut that can also provide readability
and performance advantages. The problem with a generic
<code class="language-plaintext highlighter-rouge">AtomicReference</code> is that not all reference types are numbers that can
be incremented. Fortunately for us, Scala gives us
<a href="http://en.wikipedia.org/wiki/Type_class">Type Classes</a> and there is
already a type class defined in Scala’s standard library for numbers:
<a href="http://www.scala-lang.org/api/current/index.html#scala.math.Numeric">Numeric[T]</a>.</p>

<p>What <code class="language-plaintext highlighter-rouge">Numeric[T]</code> does is to define, amongst others, the <code class="language-plaintext highlighter-rouge">sum</code>
operation for type <code class="language-plaintext highlighter-rouge">T</code> and of course the value for <code class="language-plaintext highlighter-rouge">one</code>. And we don’t
need more than that.</p>

<p>So we can define our <code class="language-plaintext highlighter-rouge">Ref.incrementAndGet</code> function, in a generic way,
like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code>  <span class="k">def</span> <span class="nf">incrementAndGet</span><span class="o">(</span><span class="k">implicit</span> <span class="n">num</span> <span class="k">:</span> <span class="kt">Numeric</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span>
    <span class="nf">transformAndGet</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nv">num</span><span class="o">.</span><span class="py">plus</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="nv">num</span><span class="o">.</span><span class="py">one</span><span class="o">))</span>
</code></pre></div></div>

<p>And lo and behold, this stuff works for any kind of number, not just
Ints and Longs:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">ref</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="nc">BigInt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span><span class="o">[</span><span class="kt">scala.math.BigInt</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">ref</span><span class="o">.</span><span class="py">incrementAndGet</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">scala.math.BigInt</span> <span class="o">=</span> <span class="mi">2</span>
</code></pre></div></div>

<p>Best of all, if we try doing this on things that aren’t numbers, then
it fails with a compile-time error:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">ref</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)</span>
<span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Ref</span><span class="o">(</span><span class="n">hello</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">ref</span><span class="o">.</span><span class="py">incrementAndGet</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">9</span><span class="k">:</span> <span class="kt">error:</span> <span class="kt">could</span> <span class="kt">not</span> <span class="kt">find</span> <span class="kt">implicit</span> <span class="kt">value</span> <span class="kt">for</span> <span class="kt">parameter</span> <span class="kt">num:</span> <span class="kt">Numeric</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
              <span class="nv">ref</span><span class="o">.</span><span class="py">incrementAndGet</span>
                  <span class="o">^</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">AtomicInteger</code> from Java’s standard library already has an
<code class="language-plaintext highlighter-rouge">incrementAndGet</code> and who knows, it might be more efficient than our
implementation. Maybe at some point it will get translated into a
single processor instruction. So we can take advantage of that by
specializing our <code class="language-plaintext highlighter-rouge">Ref</code> for <code class="language-plaintext highlighter-rouge">Int</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">final</span> <span class="k">class</span> <span class="nc">RefInt</span><span class="o">(</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Ref</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// ....</span>
  
  <span class="k">override</span> <span class="k">def</span> <span class="nf">incrementAndGet</span><span class="o">(</span><span class="k">implicit</span> <span class="n">num</span><span class="k">:</span> <span class="kt">Numeric</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
    <span class="nv">instance</span><span class="o">.</span><span class="py">incrementAndGet</span><span class="o">()</span>

  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">val</span> <span class="nv">instance</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">(</span><span class="n">initialValue</span><span class="o">)</span>
<span class="o">}</span>

</code></pre></div></div>

<p>And then we can make our primary constructor return a <code class="language-plaintext highlighter-rouge">RefInt</code>, in
case the initial value is an <code class="language-plaintext highlighter-rouge">Int</code>. Well, here’s how the code in
<code class="language-plaintext highlighter-rouge">shifter.concurrency.atomic.Ref</code> looks like:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">object</span> <span class="nc">Ref</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">apply</span><span class="o">(</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">RefInt</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">RefInt</span><span class="o">(</span><span class="n">initialValue</span><span class="o">)</span>

  <span class="k">def</span> <span class="nf">apply</span><span class="o">(</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">RefLong</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">RefLong</span><span class="o">(</span><span class="n">initialValue</span><span class="o">)</span>

  <span class="k">def</span> <span class="nf">apply</span><span class="o">(</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">RefBoolean</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">RefBoolean</span><span class="o">(</span><span class="n">initialValue</span><span class="o">)</span>

  <span class="k">def</span> <span class="nf">apply</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">initialValue</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Ref</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">RefAny</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">initialValue</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>There is still one difference between a <code class="language-plaintext highlighter-rouge">Ref[Int]</code> and
<code class="language-plaintext highlighter-rouge">AtomicInteger</code>. Our interface will be guilty of
<a href="http://en.wikipedia.org/wiki/Object_type_%28object-oriented_programming%29#Boxing">boxing and unboxing</a>
the integers passed to those functions. And in the wild, using
<code class="language-plaintext highlighter-rouge">AtomicInteger</code> for cheap and non-blocking counters is really common,
so it’s a pitty if we’ll have performance degradation here.</p>

<p>The fix is easy though. The Scala compiler can specialize our type T
for primitive types, if we annotate our type like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="k">trait</span> <span class="nc">Ref</span><span class="o">[</span><span class="kt">@specialized</span><span class="o">(</span><span class="kt">scala.Int</span>, <span class="kt">scala.Long</span>, <span class="kt">scala.Boolean</span><span class="o">)</span> <span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In the example, the compiler will specialize the <code class="language-plaintext highlighter-rouge">Ref[T]</code> interface
for Ints, Longs and Booleans, to avoid the boxing and unboxing
overhead.</p>

<p>What this will do is to generate specialized methods for these
primitive types. You can inspect the generated interface easily with
the <code class="language-plaintext highlighter-rouge">javap</code> utility. For instance, let’s see what it generates for
<code class="language-plaintext highlighter-rouge">compareAndSet</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">$</span> <span class="n">javap</span> <span class="nv">shifter</span><span class="o">.</span><span class="py">concurrency</span><span class="o">.</span><span class="py">atomic</span><span class="o">.</span><span class="py">Ref</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">compareAndSet</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">boolean</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="n">T</span><span class="o">,</span> <span class="n">T</span><span class="o">);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">boolean</span> <span class="nf">compareAndSet$mcZ$sp</span><span class="o">(</span><span class="n">boolean</span><span class="o">,</span> <span class="n">boolean</span><span class="o">);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">boolean</span> <span class="nf">compareAndSet$mcI$sp</span><span class="o">(</span><span class="n">int</span><span class="o">,</span> <span class="n">int</span><span class="o">);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">boolean</span> <span class="nf">compareAndSet$mcJ$sp</span><span class="o">(</span><span class="n">long</span><span class="o">,</span> <span class="n">long</span><span class="o">);</span>
</code></pre></div></div>

<p>Or for <code class="language-plaintext highlighter-rouge">incrementAndGet</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="code"><code><span class="n">$</span> <span class="n">javap</span> <span class="nv">shifter</span><span class="o">.</span><span class="py">concurrency</span><span class="o">.</span><span class="py">atomic</span><span class="o">.</span><span class="py">Ref</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">incrementAndGet</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">T</span> <span class="nf">incrementAndGet</span><span class="o">(</span><span class="nv">scala</span><span class="o">.</span><span class="py">math</span><span class="o">.</span><span class="py">Numeric</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">boolean</span> <span class="nf">incrementAndGet$mcZ$sp</span><span class="o">(</span><span class="nv">scala</span><span class="o">.</span><span class="py">math</span><span class="o">.</span><span class="py">Numeric</span><span class="o">&lt;</span><span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Object</span><span class="o">&gt;);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">int</span> <span class="nf">incrementAndGet$mcI$sp</span><span class="o">(</span><span class="nv">scala</span><span class="o">.</span><span class="py">math</span><span class="o">.</span><span class="py">Numeric</span><span class="o">&lt;</span><span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Object</span><span class="o">&gt;);</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">long</span> <span class="nf">incrementAndGet$mcJ$sp</span><span class="o">(</span><span class="nv">scala</span><span class="o">.</span><span class="py">math</span><span class="o">.</span><span class="py">Numeric</span><span class="o">&lt;</span><span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Object</span><span class="o">&gt;);</span>
</code></pre></div></div>

<p>So it’s basically method overloading done by the Scala
compiler. Clearly this adds some overhead in the generated .class
files and it might not do what you think it does, so use it only if
you really need it.</p>

<p>As I was saying in the beginning, make sure to also (<strong>links update March 31, 2014</strong>):</p>

<ul>
  <li>see the code in <a href="https://github.com/alexandru/monifu">project Monifu</a></li>
  <li>checkout the <a href="http://www.monifu.org/monifu-core/current/api/#monifu.concurrent.atomic.package">API docs</a></li>
</ul>

<p>Also, you may be interested in using
<strong><a href="http://nbronson.github.io/scala-stm/">scala-stm</a></strong>, a library for
<em>shared transactional memory</em>, that basically gives you the ability to
orchestrate multiple atomic references at once.</p>

  </div>

  <div id="article-details">
    
    <time itemprop="dateModified" content="2013-05-07T00:00:00+0000">
        Published: May 7, 2013
    </time>
    
      | Written by <a href="https://alexn.org/about/#alexelcu" itemprop="url" rel="author">Alexandru Nedelcu</a>
    

    <div id="all-categories">
      Tags:
      
        
        <a href="/blog/tag/languages/" class="category">Languages</a>
      
         | 
        <a href="/blog/tag/fp/" class="category">FP</a>
      
         | 
        <a href="/blog/tag/scala/" class="category">Scala</a>
      
         | 
        <a href="/blog/tag/java/" class="category">Java</a>
      
         | 
        <a href="/blog/tag/multithreading/" class="category">Multithreading</a>
      
         | 
        <a href="/blog/tag/concurrency/" class="category">Concurrency</a>
      
    </div>
  </div>

  
  <div class="related">
      <h2 id="related-articles">
        
        
          Related Articles <a href="#related-articles" class="anchor">#</a>
        
        
      </h2>
    
    <div class="container">
      
      
      <div class="item">
        <a class="related-link" href="/blog/2013/03/14/jvm-multithreading-monitor-locks-visibility/">
          JVM Multithreading: Monitor Locks and Visibility
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/languages" class="tag">Languages</a>
            
               | <a href="/blog/tag/fp" class="tag">FP</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
               | <a href="/blog/tag/java" class="tag">Java</a>
            
               | <a href="/blog/tag/multithreading" class="tag">Multithreading</a>
            
               | <a href="/blog/tag/concurrency" class="tag">Concurrency</a>
                        
          </div>
          <time>March 14, 2013</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2012/11/02/scala-functional-programming-type-classes/">
          On Scala, Functional Programming and Type-Classes
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/languages" class="tag">Languages</a>
            
               | <a href="/blog/tag/fp" class="tag">FP</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
               | <a href="/blog/tag/java" class="tag">Java</a>
                        
          </div>
          <time>November 2, 2012</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2021/02/22/countdownlatch-async-dirty/">
          Implementing a CountDownLatch (async and dirty)
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/concurrency" class="tag">Concurrency</a>
            
               | <a href="/blog/tag/jvm" class="tag">JVM</a>
            
               | <a href="/blog/tag/multithreading" class="tag">Multithreading</a>
            
               | <a href="/blog/tag/programming" class="tag">Programming</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
               | <a href="/blog/tag/video" class="tag">Video</a>
                        
          </div>
          <time>February 22, 2021</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      <div class="clearfix"></div>
    </div>
  </div>
  

  
</article>

      </div>
   </div><!-- end .content -->

   <script async src="/assets/js/modernizr.custom.15390.js?202209080446" type="text/javascript"></script>
<script async src="/assets/js-managed/jquery/dist/jquery.slim.min.js?202209080446" type="text/javascript"></script>
<script async src="/assets/js/dropcap.min.js?202209080446" type="text/javascript"></script>
<script async src="/assets/js/responsive-nav.min.js?202209080446" type="text/javascript"></script>

<script async src="/assets/js/scripts.js?202209080446" type="text/javascript"></script>


<script type="text/javascript">
  (function () {
    var h = "hostname" in document.location && document.location.hostname || "";
    if (h != "" && h.indexOf("alexn.org") == -1) {
      return
    }
    var p = (function () {
      var query = window.location.search.substring(1);
      var vars = query.split('&');
      var p = {};
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        p[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
      }
      return p;
    })();

    var now = new Date();
    var url = "https://ly.alexn.org/m.php?idsite=1&rec=1&action_name=Towards+a+Better+AtomicReference&url=https%3A%2F%2Falexn.org%2Fblog%2F2013%2F05%2F07%2Ftowards-better-atomicreference-scala%2F" + 
      "&rand=" + encodeURIComponent(Math.floor(Math.random() * Number.MAX_SAFE_INTEGER)) +
      "&h=" + now.getHours() +
      "&m=" + now.getMinutes() +
      "&s=" + now.getSeconds();

    if ("pk_campaign" in p)
      url += "&_rcn=" + encodeURIComponent(p["pk_campaign"]);
    if ("pk_kwd" in p)
      url += "&_rck=" + encodeURIComponent(p["pk_kwd"]);
    if ("referrer" in document && document.referrer) 
      url += "&urlref=" + encodeURIComponent(document.referrer);
    if ("screen" in window) 
      url += "&res=" + screen.width + "x" + screen.height;

    var d=document, i=d.createElement("img"),s0=d.getElementsByTagName("script"),s=s0[s0.length-1];
    i.setAttribute("alt", "");
    i.setAttribute("referrerpolicy", "no-referrer-when-downgrade");
    i.setAttribute("src", url);
    i.setAttribute("width", "1");
    i.setAttribute("height", "1");
    i.setAttribute("style", "position: fixed !important; bottom: -1px !important; right: -1px !important; border:none !important; margin:0px !important;");
    s.parentNode.insertBefore(i,s);
  })();
</script>
<noscript>
  <img referrerpolicy="no-referrer-when-downgrade" src="https://ly.alexn.org/m.php?idsite=1&rec=1&action_name=Towards+a+Better+AtomicReference&url=https%3A%2F%2Falexn.org%2Fblog%2F2013%2F05%2F07%2Ftowards-better-atomicreference-scala%2F" width="1" height="1" style="position: fixed !important; bottom: -1px !important; right: -1px !important; border:none !important; margin:0px !important;" alt="" />
</noscript>

   <div class="footer">
  
  <div class="container">
    <div class="contributions">
      <div id="footer-comments-widget">
  <h2 id="comments">
  Comments
  <a href="#comments" class="anchor">#</a>
</h2>

<p class="only-js">
  Want to chat in private? Email me: 
  <script id="email-script">
    (function () {
      var lhs = "contact22+comments";
      var rhs = "alexn.org";
      var d = document;
      var a = d.createElement("a");
      a.setAttribute("target", "_blank");
      a.setAttribute("href", "mailto:" + lhs + "@" + rhs + "?subject=Comment%20on%3A%20Towards%20a%20Better%20AtomicReference");
      a.text = lhs + "@" + rhs;
      var es = d.getElementById("email-script");
      es.parentNode.insertBefore(a, es);
    })();
  </script>
</p>


<div id="comments">
  <script data-isso="https://alexn.org/comments/alexn/"
          data-isso-css="false"
          data-isso-lang="en"
          data-isso-reply-to-self="true"
          data-isso-require-author="true"
          data-isso-require-email="false"
          data-isso-reply-notifications="true"
          data-isso-max-comments-top="10"
          data-isso-max-comments-nested="5"
          data-isso-reveal-on-click="5"
          data-isso-gravatar="true"
          data-isso-avatar="false"
          data-isso-vote="false"
          data-vote-levels=""
          src="https://alexn.org/comments/alexn/js/embed.min.js"></script>
  <section id="isso-thread" data-title="Towards a Better AtomicReference">
  </section>
</div>
<noscript>
  <div class="note-warning">
    <strong>Enable JavaScript to see the email address or the public comments!</strong>
    <br>
    <span class="extra">
      Commenting widget is powered by a self-hosted commenting server.
      <span style="white-space: nowrap;">
        Read the <a href="/docs/privacy-policy/">privacy policy</a>.
      </span>
    </span>
  </div>
</noscript>

</div>

<h2 id="contribute">
  Contribute
  <a href="#contribute" class="anchor">#</a>
</h2>

<p>
  Fix or add to this article by submitting a pull request:<br/>
  <a style="white-space: nowrap;" href="https://github.com/alexandru/alexn.org/blob/main/_posts/2013-05-07-towards-better-atomicreference-scala.md" target="_blank">Edit Page on GitHub</a>
</p>

<p>
  Donate to cover ongoing website costs, or buy me coffee ☕️😋 <br/>
  <a href="https://www.patreon.com/bePatron?u=6102596" target="_blank" class="patreon-button">
    <img label="Become a Patron!" alt="Become a Patron!" title="Become a Patron!" src="/assets/media/buttons/patreon.png" />
  </a>
</p>


<h2 id="subscribe">
  Subscribe
  <a href="#subscribe" class="anchor">#</a>
</h2>

<!-- Begin Mailchimp Signup Form -->
<div id="mc_embed_signup">
  <form action="https://alexn.us4.list-manage.com/subscribe/post?u=5bffa2af025192a58345bd5dc&amp;id=1c9005b255"
    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank"
    novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="mc-field-group field">
        <label for="mce-EMAIL">Email Address <sup class="asterisk">*</sup></label>
        <input type="email" value="" name="EMAIL" class="required email full-width" id="mce-EMAIL" placeholder="user@domain.com" required>
      </div>
      <!-- <div class="mc-field-group field">
        <label for="mce-FULLNAME">Name</label>
        <input type="text" value="" name="FULLNAME" class="full-width" id="mce-FULLNAME" placeholder="John Doe">
      </div> -->
      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text"
          name="b_5bffa2af025192a58345bd5dc_1c9005b255" tabindex="-1" value=""></div>
      <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"
          class="button"></div>
    </div>
  </form>
</div>

<div class="note-warning">
  <span class="extra">
    Newsletter subscription uses Mailchimp, see <a href="/docs/privacy-policy/">privacy policy</a>.
    If you're not seeing the form, it may be blocked by the browser; <a target="_blank" href="http://eepurl.com/g5ClAT"><em><span style="white-space: nowrap;">try the external subscribe page &#10141;</span></em></a>
  </span>
</div>


    </div>  
  </div>
  

  <div class="bottom">
    <div class="container">
      <span class="copy">
          &copy; 2009-2022
      </span>
      <span class="links">
        <a href="/docs/license/">License</a> |
        <a href="/docs/privacy-policy/">Privacy Policy</a> |
        <a href="/about/#contact">Contact</a>
      </span>
    </div>
  </div>
</div><!-- end .footer -->

</body>
</html>
