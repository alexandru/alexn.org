<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="color-scheme" content="light dark">
    <!--https://developers.google.com/web/fundamentals/design-and-ux/browser-customization-->
    <meta name="theme-color" content="#493667">

    <title>Scala OOFP Design Sample - Alexandru Nedelcu</title>
    

    <!-- Open Graph Meta -->
    <meta property="og:site_name" content="Alexandru Nedelcu">
    <meta property="og:title" content="Scala OOFP Design Sample">
    <meta property="og:description" content="Scala is considered a multi-paradigm language, for better or worse, being one of the best OOP languages, which is why it’s so versatile. Let’s do a design exercise, going from OOP to static FP, and back. Let’s understand the various techniques promoted in the community, and understand why the OOP design isn’t just “idiomatic” for Scala, but can be superior to alternatives.">
    <meta property="og:url" content="https://alexn.org/blog/2022/04/18/scala-oop-design-sample/">
    <meta property="article:published_time" content="2022-04-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-06-06T12:19:40+00:00">
    <meta property="og:type" content="article" />
    <meta property="og:image" content="https://alexn.org/assets/media/articles/2022-04-oofp.png?202411060510" />
    <meta property="og:image:secure_url" content="https://alexn.org/assets/media/articles/2022-04-oofp.png?202411060510" />
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:src" content="https://alexn.org/assets/media/articles/2022-04-oofp.png?202411060510">
    <meta name="twitter:site" content="@alexelcu">
    <meta name="twitter:creator" content="@alexelcu">
    <meta name="twitter:title" content="Scala OOFP Design Sample">
    <meta name="twitter:url" content="https://alexn.org/blog/2022/04/18/scala-oop-design-sample/">
    <meta name="twitter:description" content="Scala is considered a multi-paradigm language, for better or worse, being one of the best OOP languages, which is why it’s so versatile. Let’s do a design exercise, going from OOP to static FP, and back. Let’s understand the various techniques promoted in the community, and understand why the OOP design isn’t just “idiomatic” for Scala, but can be superior to alternatives.">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="48x48" />
    <link rel="icon" href="/assets/logo/16px.png" sizes="16x16" />
    <link rel="icon" href="/assets/logo/32px.png" sizes="32x32" />
    <link rel="icon" href="/assets/logo/192px.png" sizes="192x192" />
    <link rel="icon" href="/assets/logo/270px.png" sizes="270x270" />
    <link rel="icon" href="/assets/logo/512px.png" sizes="512x512" />
    <link rel="apple-touch-icon-precomposed" href="/assets/logo/180px.png" />
    <meta name="msapplication-TileImage" content="/assets/logo/270px.png" />

    <!-- Come and get me RSS readers -->
    <link rel="alternate" type="application/rss+xml" title="All articles (blog + wiki)" href="/feeds/all.xml" />

    <!-- Points at alexn.org, taking care of the search-engine indexing of mirrors: -->
    <link rel="canonical" href="https://alexn.org/blog/2022/04/18/scala-oop-design-sample/">

    <style type="text/css" media="all">
      /*! normalize.css v6.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:rgba(0,0,0,0);-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body .intro{font-size:1.25em;line-height:1.7}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,.h5,h6,.h6{margin:.5rem 0 1.5rem;font-family:Tahoma,Helvetica,Arial,sans-serif}h1,.h1{font-size:2em;line-height:1.25}@media(min-width: 43.75em){h1,.h1{font-size:2.5em;line-height:1.125}}@media(min-width: 56.25em){h1,.h1{font-size:3em;line-height:1.05}}h2,.h2{font-size:1.625em;line-height:1.15384615}@media(min-width: 43.75em){h2,.h2{font-size:2em;line-height:1.25}}@media(min-width: 56.25em){h2,.h2{font-size:2.25em;line-height:1.25}}h3,.h3{font-size:1.375em;line-height:1.13636364}@media(min-width: 43.75em){h3,.h3{font-size:1.5em;line-height:1.25}}@media(min-width: 56.25em){h3,.h3{font-size:1.75em;line-height:1.25}}h4,.h4{font-size:1.125em;line-height:1.11111111}@media(min-width: 43.75em){h4,.h4{line-height:1.22222222}}.button__outline,.button-tertiary,.button-secondary,.button{background-color:#00649e;display:inline-block;position:relative;font-family:Tahoma,Helvetica,Arial,sans-serif;text-decoration:none;color:#fff;font-size:1em;line-height:1.2em;font-weight:normal;padding:.5em 1.5em;border:0;border-radius:4px;cursor:pointer;margin-bottom:.5em;transition:background-color .14s ease-in-out}.button__outline:hover,.button-tertiary:hover,.button-secondary:hover,.button:hover,.button__outline:focus,.button-tertiary:focus,.button-secondary:focus,.button:focus{color:#fff;text-decoration:none;background-color:#00446b}.button__outline:active,.button-tertiary:active,.button-secondary:active,.button:active{top:1px}.button-secondary{background-color:#008bd8}.button-secondary:hover{background-color:#006aa5}.button-tertiary{background-color:#aaa}.button-tertiary:hover{background-color:#919191}.button__outline{background-color:rgba(0,0,0,0);border:3px solid #00649e;color:#00649e}.button__outline:hover{background-color:#00649e;color:#fff}span.link-logo{text-decoration:none !important}span.link-logo img{height:28px;width:28px;vertical-align:middle;margin-right:10px}a span.link-logo img{filter:invert(17%) sepia(47%) saturate(1856%) hue-rotate(174deg) brightness(95%) contrast(97%)}label{display:block;margin-bottom:5px}input[type=text],input[type=email],input[type=phone],input[type=password],input[type=number],input[type=search],textarea{background:#e6e6e6;padding:5px;outline:none;border:none;height:44px;width:300px;margin-bottom:.5rem;font-size:100%}input[type=text]:focus,input[type=email]:focus,input[type=phone]:focus,input[type=password]:focus,input[type=number]:focus,input[type=search]:focus,textarea:focus{border:1px solid #00649e}input[type=text].full-width,input[type=email].full-width,input[type=phone].full-width,input[type=password].full-width,input[type=number].full-width,input[type=search].full-width,textarea.full-width{width:100%}textarea{height:132px}form{margin-bottom:40px}form .field{margin-bottom:20px}form label{color:#666}form .note-warning{margin-top:5px;color:#aaa}form .req{font-style:italic}form .asterisk{color:darkred}form .error .reason{margin-top:5px;color:#ff4136}form .error input[type=text],form .error input[type=email],form .error input[type=phone],form .error input[type=password],form .error input[type=number],form .error input[type=search],form .error textarea{border-color:#ff4136}table{width:100%;border:1px solid #d0d0d0;margin-bottom:1.5em}table caption{margin:0 0 7px;font-size:.75em;color:#aaa;text-transform:uppercase;letter-spacing:1px}tr{border-bottom:1px solid #d0d0d0}tr:nth-child(even){background-color:#f7f7f7}td{padding:7px;border-right:1px solid #d0d0d0}td:last-child{border-right:0}th{background-color:#f7f7f7;border-bottom:1px solid #d0d0d0;border-right:1px solid #d0d0d0}th:last-child{border-right:0}pre>code{color:#333;background:#f8f8f8;display:block;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #e8e8e8;line-height:1.3;font-size:.9em}:not(pre)>code{background-color:rgba(27,31,35,.05);padding:.2em .4em;margin:0;font-size:85%;border-radius:3px}div.formula-code{color:#333;background:#f8f8f8;display:block;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #e8e8e8;margin:0 0 20px 0}div.formula-code .MathJax_Display{margin:0 !important}#isso-thread *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#isso-thread{padding:0;margin:0}h4.isso-thread-heading{color:#555;font-weight:bold}.isso-feedlink{float:right;padding-left:1em}.isso-feedlink a{font-size:.8em;vertical-align:bottom}.isso-comment{max-width:68em;margin:0 auto}.isso-preview .isso-comment{padding-top:0;margin:0}.isso-comment:not(:first-of-type),.isso-follow-up .isso-comment{border-top:1px solid rgba(0,0,0,.1);margin-bottom:.5em}.isso-avatar{display:block;float:left;margin:.95em .95em 0}.isso-avatar svg{max-width:48px;max-height:48px;width:100%;height:100%;border:1px solid rgba(0,0,0,.2);border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1)}.isso-text-wrapper{display:block;padding:.95em}.isso-follow-up{padding-left:calc(7% + 20px)}.isso-comment-footer{font-size:.95em}.isso-comment-header{font-size:.85em}.isso-comment-header a{text-decoration:none}.isso-comment-header .isso-spacer{padding:0 6px}.isso-spacer,.isso-permalink,.isso-note,.isso-parent{color:gray;font-weight:normal;text-shadow:none}.isso-spacer:hover,.isso-permalink:hover,.isso-note:hover,.isso-parent:hover{color:#606060}.isso-note{float:right}.isso-author{font-weight:bold;color:#555}.isso-page-author-suffix{font-weight:bold;color:#2c2c2c}.isso-textarea,.isso-preview{margin-top:.2em;width:100%;border:1px solid #f0f0f0;border-radius:2px;box-shadow:0 0 2px #888}.isso-text p{margin-top:.2em}.isso-text p:last-child{margin-bottom:.2em}.isso-text h1,.isso-text h2,.isso-text h3,.isso-text h4,.isso-text h5,.isso-text h6{font-size:130%;font-weight:bold}.isso-text pre{background:#eee;border:1px solid #ddd;padding:10px 15px;color:#4d4d4c;overflow:auto;line-height:1.5em}.isso-text :not(pre)>code{padding:.2em .4em;margin:0;font-size:85%;background-color:#eee;border-radius:6px}.isso-comment-footer{font-size:.8em;color:gray;clear:left}.isso-feedlink,.isso-comment-footer a{font-weight:bold;text-decoration:none}.isso-feedlink:hover,.isso-comment-footer a:hover{color:#111;text-shadow:#aaa 0 0 1px}.isso-comment-footer>a{position:relative;top:.2em}.isso-comment-footer>a+a{padding-left:1em}.isso-comment-footer .isso-votes{color:gray}.isso-upvote svg,.isso-downvote svg{position:relative;top:.2em}.isso-comment .isso-postbox{margin-top:.8em}.isso-comment.isso-no-votes>*>.isso-comment-footer .isso-votes{display:none}.isso-postbox{max-width:68em;margin:0 auto 2em;clear:right}.isso-form-wrapper{display:block;padding:0}.isso-textarea,.isso-preview{margin:0 0 .3em;padding:.4em .8em;border-radius:3px;background-color:#fff;border:1px solid rgba(0,0,0,.2);box-shadow:0 1px 2px rgba(0,0,0,.1)}.isso-textarea{outline:0;width:100%;resize:none}.isso-form-wrapper input[type=checkbox]{vertical-align:middle;position:relative;bottom:1px;margin-left:0}.isso-notification-section{font-size:.9em;padding-top:.3em;display:none;padding-bottom:10px}.isso-auth-section{display:block}.isso-textarea:focus,.isso-input-wrapper input:focus,.isso-auth-section input:focus{outline:2px solid #3584e4}.isso-input-wrapper{display:inline-block;position:relative;margin:0 1% 0 0}.isso-input-wrapper input{display:block;padding:.3em 10px;max-width:100%;border-radius:3px;background-color:#fff;line-height:1.4em;border:1px solid rgba(0,0,0,.2);box-shadow:0 1px 2px rgba(0,0,0,.1)}.isso-input-wrapper label{display:block;line-height:1.4em;height:1.4em}.isso-post-action{display:block;float:right;margin:1.4em 0 0 5px}.isso-post-action>input{padding:calc(.3em - 1px);border-radius:2px;border:1px solid #ccc;background-color:#ddd;cursor:pointer;outline:0;line-height:1.4em;box-shadow:0 1px 2px rgba(0,0,0,.1)}.isso-post-action>input:hover{background-color:#ccc}.isso-post-action>input:active{background-color:#bbb}.isso-preview,.isso-post-action input[name=edit],.isso-postbox.isso-preview-mode>.isso-form-wrapper input[name=preview],.isso-postbox.isso-preview-mode>.isso-form-wrapper .isso-textarea{display:none}.isso-postbox.isso-preview-mode>.isso-form-wrapper .isso-preview{display:block}.isso-postbox.isso-preview-mode>.isso-form-wrapper input[name=edit]{display:inline}.isso-preview{background-color:#f8f8f8;background:repeating-linear-gradient(-45deg, #f8f8f8, #f8f8f8 10px, #fff 10px, #fff 20px)}.isso-target{animation:isso-target-fade 5s ease-out}@keyframes isso-target-fade{0%{background-color:#eee5a1}}@media screen and (max-width: 600px){.isso-input-wrapper{display:block;max-width:100%;margin:0 0 .3em}.isso-input-wrapper input{width:100%}.isso-post-action{margin-top:0}}html.dark-reader body{background-image:none}html.dark-reader body .footer{background-image:none}html{box-sizing:border-box;background-color:#fefefe}*,*:before,*:after{box-sizing:inherit}body{background-color:#fff;background-image:url("/assets/media/tile-graphpaper.png");font-family:Georgia,Times,serif;line-height:1.75;font-size:112.5%;color:#111;overflow-x:hidden;margin:0}body p,body ul{margin:0 0 2rem}body code{font-family:"ui-monospace","SFMono-Regular","SF Mono",Menlo,Consolas,"Liberation Mono",monospace;font-variant-ligatures:common-ligatures}::-moz-selection{background:#00649e;color:#fff}::selection{background:#00649e;color:#fff}img,video,audio,iframe,object{max-width:100%;height:auto}.container{max-width:610px;padding:0 20px;margin-left:auto;margin-right:auto}a{color:#00649e}a:hover{color:#003452}.nav-collapse{z-index:1}.nav-collapse ul{margin:0;padding:0;width:100%;display:block;list-style:none}.nav-collapse ul li{width:100%;display:block;background:#57457a;border-bottom:2px solid #675291}.nav-collapse ul li a{color:#fff;text-decoration:none;display:block;padding:5px 2rem}.nav-collapse{clip:rect(0 0 0 0);max-height:0;position:absolute;display:block;overflow:hidden;transform:scale(1);transform-origin:0 0;clear:both;width:100%}.no-js .nav-collapse{position:relative;max-height:none}.nav-collapse.opened{max-height:9999px}.nav-toggle{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;float:right;line-height:2em;margin-top:.5em;background-color:#00649e;border-radius:4px;padding:0 .5em;color:#fff;text-decoration:none;position:relative;right:2rem;transition:all .2s ease-in-out}.nav-toggle:hover{color:#fff;background-color:#00446b}.noList{list-style:none;padding-left:0;margin-left:0}dt{font-weight:bold}dd{margin:0 0 1.5rem}.post ul ul,.post ul ol,.post ol ul,.post ol ol{margin:0}ul.links-with-icons,ol.links-with-icons{list-style:none;padding-left:20px}.pageTitle{margin:2rem auto 1em;text-align:center}.pageTitle .type{color:#888}.content{padding-top:1em}.js .header{height:3em}.header{background-color:#473864;background-size:cover;background-position:center center;color:#fff;padding:0}.header .container{padding:0;max-width:100%}.header h1{margin:0;float:left;padding-left:2rem;font-size:1em;line-height:3em;font-family:Tahoma,Helvetica,Arial,sans-serif;text-transform:lowercase}.header h1 .wide1,.header h1 .wide2{display:none}.header h1 a{color:#e9d9ff;text-decoration:none;font-family:Tahoma,Helvetica,Arial,sans-serif;letter-spacing:.1rem;font-variant-ligatures:common-ligatures;text-shadow:0px 0px 4px #000}.post .postTitle{text-align:center;margin-top:2rem;margin-bottom:1rem}.post blockquote{color:#57606a;border-left:.25em solid #d9d9d9;display:block;margin:0;padding-left:1rem}.post blockquote p{margin-left:0;margin-right:0;width:100%}.post .meta,.post #article-details{text-align:center;color:gray;font-family:Georgia,Times,serif;font-weight:normal}.post .meta a,.post #article-details a{color:#1d8dcd;text-decoration:none}.post .meta a:hover,.post #article-details a:hover{text-decoration:underline}.post figure{margin:3rem 0}.post figure figcaption{text-align:center;font-size:.9em;font-style:italic;color:#5e5e5e}.post figure img{margin:0 auto;display:block}.post img{border-radius:3px}.post img.left{float:left;margin-right:1em;margin-bottom:1em}.post img.right{float:right;margin-left:1em;margin-bottom:1em}.post pre>code{clear:both;margin-bottom:2rem}.post .intro::first-letter{color:#00649e;font-size:250%;line-height:1}.post .featuredImage{position:relative;margin-top:2rem}.post .featuredImage img{margin-bottom:0}.post #article-details{border:0;border-top:2px solid #d9d9d9;width:100%;text-align:left;margin:0 auto;padding:1rem 0}.post #article-details #all-categories{margin-top:1rem;padding-top:1rem;border-top:1px solid #e6e6e6}.post .snippets ul{margin-top:1rem}.post .snippets ul li time{font-weight:normal;font-size:.9em;color:gray}.post hr{border-style:solid;border-color:#d9d9d9;border-width:1.5px 0 0 0;margin-top:2rem;margin-bottom:2rem}.post div.footnotes{font-size:85%}.post div.footnotes ol{margin:0;margin-bottom:2rem;width:100%;list-style-position:outside;padding-left:30px}.post div.footnotes li p{margin-left:0;margin-right:0;width:100%}.post.snippet .postTitle{font-size:100%}.post div.related{border-top:1.5px solid #d9d9d9}.post div.related,div.archive_list{width:100%;margin:0 auto}.post div.related h2,div.archive_list h2{margin:0;margin-top:1rem;color:#000}.post div.related div.container,div.archive_list div.container{display:block;margin-top:2rem}.post div.related div.container div.item,div.archive_list div.container div.item{clear:left;margin-bottom:1rem;width:100%}.post div.related div.container div.item div.related-image,div.archive_list div.container div.item div.related-image{display:block;float:right;margin-bottom:1rem;margin-left:1rem;width:42px;height:42px;background-position:center;background-repeat:no-repeat;background-size:cover;background-color:rgba(0,0,0,.1);border-radius:2px;text-decoration:none;padding:1rem}.post div.related div.container div.item .related-meta,div.archive_list div.container div.item .related-meta{font-family:Georgia,Times,serif;font-weight:normal;font-size:.9em;color:gray;line-height:1.5}.post div.related div.container div.item .related-meta a,div.archive_list div.container div.item .related-meta a{color:#1d8dcd;text-decoration:none}.post div.related div.container div.item .related-meta a:hover,div.archive_list div.container div.item .related-meta a:hover{text-decoration:underline}div.archive_list{position:relative}div.archive_list h3{margin-top:4rem;color:#a66c75}div.archive_list:before{content:"";position:absolute;bottom:-2rem;left:0;background:#e6e6e6;height:2px;width:60px}div.archive_list.last:before{display:none}.postNav{border-top:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;overflow:hidden}.postNav .prev,.postNav .next{display:block;width:100%;height:5rem;overflow:hidden;position:relative;font-family:Tahoma,Helvetica,Arial,sans-serif;font-weight:800;font-size:.9em;text-transform:uppercase;text-align:center}.postNav .prev img,.postNav .next img{z-index:1;display:block;position:absolute;top:50%;transform:translateY(-50%);left:0;width:100%;height:auto}.postNav .prev span,.postNav .next span{z-index:10;position:relative;padding:.5rem;position:absolute;top:50%;transform:translateY(-50%);width:100%;line-height:1.4}.postNav .prev.image,.postNav .next.image{text-decoration:none;color:#fff;text-shadow:1px 1px 3px rgba(0,0,0,.8);padding:0 .5rem;position:relative;transition:all .2s ease-in-out}.postNav .prev:hover.image,.postNav .next:hover.image{opacity:.8}.postNav .prev span{left:0}.postNav .next span{right:0}.footer{margin-top:2rem;clear:both;background:#fafafa}.footer hr{display:block;clear:both;border:1px solid #eaeaea;margin:1rem 0}.footer #footer-comments-widget{border-bottom:2px solid #eaeaea;margin-bottom:1rem}.footer .contributions{padding:1rem 0}.footer .contributions .note-warning{border:1px solid #e1e4e8;background-color:#f6f8fa;border-radius:3px;padding:16px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin-bottom:1rem}.footer .contributions .note-warning .extra{color:#586069}.footer .contributions .note-warning .extra .link-logo img{opacity:.6}.footer .contributions #disqus_thread{max-width:90%;margin:0 auto;overflow:auto}.footer .contributions h2,.footer .contributions h3{margin-top:0;color:#a66c75}.footer .contributions #share{border-bottom:1px solid #c69aa1}.footer .contributions #isso-thread{font-size:90%}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper>div.isso-comment-header{display:inline-block;vertical-align:middle}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper>div.isso-text{clear:both}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper p{margin:0 0 .7rem}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper blockquote{color:#777;margin:5px 0;padding:5px;padding-left:10px;border-left:4px solid #ddd;background-color:#f7f7f7}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper code{color:#333;background:#f8f8f8}.footer .contributions #isso-thread .isso-comment>.isso-text-wrapper pre{color:#333;background:#f8f8f8;display:block;white-space:pre;overflow:auto;word-wrap:normal;border:1px solid #e8e8e8}.footer .contributions #isso-thread .isso-form-wrapper{font-size:90%}.footer .contributions #isso-thread .isso-textarea-wrapper textarea.isso-textarea{height:80px}.footer .contributions #isso-thread .isso-auth-section{font-size:90%}.footer .contributions #isso-thread .isso-auth-section .isso-input-wrapper{display:block}.footer .contributions #isso-thread .isso-auth-section .isso-input-wrapper input{width:100%;height:auto}.footer .contributions #isso-thread .isso-auth-section .isso-post-action{margin:.5em 0px 0px 5px}.footer .contributions #isso-thread .isso-auth-section .isso-post-action input{padding:.2em 1em;border-radius:4px;border:0;margin-right:5px}.footer .contributions #isso-thread .isso-auth-section .isso-post-action input[type=submit]{background-color:#00649e;color:#fff;font-weight:bold;border:0;cursor:pointer}.footer .contributions #isso-thread .isso-auth-section .isso-post-action input[type=submit]:hover{color:#fff;background-color:#007bc2}.footer .contributions #isso-thread #isso-root{clear:both}.footer .contributions #isso-thread .isso-avatar img{max-width:24px;max-height:24px;border-radius:3px}.footer .contributions #mc_embed_signup form{margin-bottom:0}.footer .bottom{background:#f2f2f2;font-size:.8em;color:#656c7a;border-top:2px solid #eaeaea;border-bottom:2px solid #eaeaea;padding:1rem 0}.footer .bottom .container{max-width:90%;text-align:center}.footer .bottom .container .copy,.footer .bottom .container .links{display:block}.pagination div.page_number{color:gray;border-top:1px dashed #aaa;padding:1rem 0}.pagination .next{float:left}.pagination .previous{float:right}.posts li{margin-bottom:4rem;position:relative}.posts li:before{content:"";position:absolute;bottom:-2rem;left:0;background:#e6e6e6;height:2px;width:60px}.posts li:last-child:before{display:none}.posts li a{text-decoration:none}.posts li a:hover{text-decoration:underline}.posts li .meta{font-family:Georgia,Times,serif;font-weight:normal;font-size:.9em;color:gray}.posts li .meta time{display:block}.posts li .meta a{color:#1d8dcd;text-decoration:none}.posts li .meta a:hover{text-decoration:underline}.posts li h3{margin:0 0 .5em}#home{padding-top:2em}#home .postTitle{text-align:center}img.right{float:none}.patreon-button img{width:170px;height:40px}.post.about img.avatar{width:100px}.small-note{font-size:80%;color:gray}.video .youtube-play-link{position:relative;display:block;box-shadow:0px 0px 5px 0px rgba(50,50,50,.3);border-radius:3px}.video .youtube-play-link:before{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-webkit-transform:translate(-50%, -50%);display:block;width:80px;height:56px;font-size:1px;content:" ";opacity:.8;z-index:100;background-image:url(/assets/media/youtube.png);background-size:80px 56px;background-position:center;background-repeat:no-repeat;transition-timing-function:ease-in;transition:opacity .3s}.video .youtube-play-link:hover:before{opacity:1}.video .youtube-play-link img.play-thumb{display:block;min-height:70px}.video .video-container{position:relative;padding-bottom:56.25%;padding-top:10px;height:0;overflow:hidden}.video .video-container iframe,.video .video-container object,.video .video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}.no-js .only-js{display:none}.no-js .video .video-container{display:none}.posts img{border-radius:3px}.posts figure{margin:1rem 0}.posts figure figcaption{text-align:center;font-size:.9em;font-style:italic;color:#5e5e5e}.posts figure img{margin:0 auto;display:block}.hidden{display:none}.post header nav.toc{border-top:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;margin-bottom:1rem}.post header nav.toc ul{margin-bottom:1rem}.post header nav.toc .toc-title{font-weight:bold;margin:1rem auto 1rem}.post .warn-bubble,.post .info-bubble,.post.privacy_policy #opt_out_frame iframe{background-color:rgba(226,231,240,.3);color:#555;padding:7px;border:2px dashed #e2f0e7;border-radius:10px}.post .warn-bubble{color:#655;background-color:rgba(243,235,237,.3);border:2px dashed #f6ddd7}.post pre>code,.post pre>code.hljs{border-radius:0;margin:0 auto;padding:2px;width:100%}.post .formula-code,.post pre>code{font-size:90%}.post.privacy_policy #opt_out_frame iframe{width:100%;height:300px}h1,h2,h3,h4,h5,h6{color:#111;font-weight:700}h1 a.anchor,h2 a.anchor,h3 a.anchor,h4 a.anchor,h5 a.anchor,h6 a.anchor{color:#d3d3d3;font-weight:normal;text-decoration:none}h1 a.anchor:hover,h2 a.anchor:hover,h3 a.anchor:hover,h4 a.anchor:hover,h5 a.anchor:hover,h6 a.anchor:hover{color:gray}.nobr{white-space:nowrap}.clearfix{transform:scale(1);transform-origin:0 0}.clearfix:before,.clearfix:after{content:" ";display:block;height:0;overflow:hidden}.clearfix:after{clear:both}@media only screen and (min-width: 375px){.header h1 .wide1{display:inline}}@media only screen and (min-width: 500px){.header h1 .wide1,.header h1 .wide2{display:inline}.post.privacy_policy #opt_out_frame iframe{height:260px}}@media only screen and (min-width: 800px){body{font-size:125%}.content{padding-top:0;position:relative;z-index:1}.container{max-width:880px;margin-left:auto;margin-right:auto;padding:0}#home .posts,#home .pageTitle,#home .pagination,#home .archive_list{width:75%;float:none;margin:0 auto 1.5em}#home .pageTitle{margin:2rem auto 1em}.js .header,.no-js .header{height:7em;position:relative;padding-bottom:0}.js .header .wide1,.js .header .wide2,.no-js .header .wide1,.no-js .header .wide2{display:inline}.js .header .container,.no-js .header .container{position:relative;top:50%;transform:translateY(-50%);max-width:880px;overflow:hidden}.js .header .container .inner-container,.no-js .header .container .inner-container{width:75%;margin:0 auto}.js .header h1,.no-js .header h1{font-size:2em;line-height:1;padding-left:0}.js .header nav,.no-js .header nav{float:left;clear:left}.js .header nav ul,.no-js .header nav ul{margin:0}.js .header nav ul li,.no-js .header nav ul li{display:inline;line-height:3em;background:none;padding:0 5px;border:none}.js .header nav ul li a,.no-js .header nav ul li a{color:#fff;font-size:.9em;text-decoration:none;padding:0 .25em}.js .header nav ul li a:hover,.no-js .header nav ul li a:hover{color:#ccc}.js .header nav ul li.current,.no-js .header nav ul li.current{padding-bottom:.25em;border-bottom:4px solid rgba(255,255,255,.4)}.nav-collapse{position:relative;max-height:none}.nav-collapse.closed{max-height:none}.nav-collapse ul li a{display:inline-block}.nav-toggle{display:none}.post h1,.post h2,.post h3,.post h4,.post h5,.post h6,.post p,.post ul,.post ol,.post dl,.post .pageTitle,.post .content,.post .page-width,.post blockquote,.post div.footnotes{width:75%;float:none;margin:0 auto 2rem}.post hr{width:75%}.post div.footnotes{margin:0 auto 1rem}.post div.footnotes p{margin-bottom:1rem}.post h1,.post .h1,.post h2,.post .h2,.post h3,.post .h3,.post h4,.post .h4,.post h5,.post .h5,.post h6,.post .h6{margin:1rem auto}.post .pageTitle{margin:2rem auto 1em}.post .featuredImage{position:relative;margin-top:2rem}.post pre>code,.post pre>code.hljs{font-size:.8em;padding:1em;border-radius:4px}.post div.formula-code{padding:20px 10px}.post blockquote{padding-left:2rem}.post.snippet .postTitle{font-size:120%}.postNav .prev,.postNav .next{width:50%}.postNav .prev{float:left;text-align:left}.postNav .next{text-align:right;float:right}.footer .container{max-width:880px}.footer .contributions{width:75%;margin:0 auto}.footer .contributions .avatar img{max-width:48px;max-height:48px;border-radius:5px}.footer .contributions #isso-thread .isso-avatar img{max-width:32px;max-height:32px}.footer .bottom .container .copy::after{content:"|"}.footer .bottom .container .copy,.footer .bottom .container .links{display:inline}.contactContent{max-width:48%;margin-right:2%;float:left}#contact form{max-width:48%;width:48%;float:right;margin-right:0}img.right{float:right}.post.about img.avatar{width:300px}div.header nav{text-shadow:0px 0px 4px #000}#abonament form{width:75%;margin:0 auto 2rem}.post div.related{width:75%}.post #article-details{width:75%}.post.privacy_policy #opt_out_frame iframe{height:190px}.video .youtube-play-link:before{width:120px;height:84px;background-size:120px 84px}}@media only screen and (min-width: 1200px){body{font-size:137.5%}.container{max-width:990px}.container .inner-container{width:75%;margin:0 auto}.js .header .container,.no-js .header .container{max-width:990px}.post.privacy_policy #opt_out_frame iframe{height:180px}.footer .container{max-width:990px}.post.snippet .postTitle{font-size:140%}}@media(prefers-color-scheme: light){pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: StackOverflow Light
  Description: Light theme as used on stackoverflow.com
  Author: stackoverflow.com
  Maintainer: @Hirse
  Website: https://github.com/StackExchange/Stacks
  License: MIT
  Updated: 2021-05-15

  Updated for @stackoverflow/stacks v0.64.0
  Code Blocks: /blob/v0.64.0/lib/css/components/_stacks-code-blocks.less
  Colors: /blob/v0.64.0/lib/css/exports/_stacks-constants-colors.less
*/.hljs{color:#2f3337;background:#f6f6f6}.hljs-subst{color:#2f3337}.hljs-comment{color:#656e77}.hljs-attr,.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-section,.hljs-selector-tag{color:#015692}.hljs-attribute{color:#803378}.hljs-name,.hljs-number,.hljs-quote,.hljs-selector-id,.hljs-template-tag,.hljs-type{color:#b75501}.hljs-selector-class{color:#015692}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-string,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#54790d}.hljs-meta,.hljs-selector-pseudo{color:#015692}.hljs-built_in,.hljs-literal,.hljs-title{color:#b75501}.hljs-bullet,.hljs-code{color:#535a60}.hljs-meta .hljs-string{color:#54790d}.hljs-deletion{color:#c02d2e}.hljs-addition{color:#2f6f44}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}}@media(prefers-color-scheme: dark){:root{color-scheme:light dark}html,body,*{scrollbar-width:thin;scrollbar-color:#727173 #1e2223}body::-webkit-scrollbar,*::-webkit-scrollbar{width:10px}body::-webkit-scrollbar-track,*::-webkit-scrollbar-track{background:#1e2223}body::-webkit-scrollbar-thumb,*::-webkit-scrollbar-thumb{background-color:#727173;border-radius:6px;border:3px solid #1e2223}html{background-color:#171a1b;background-image:none}body{background-color:#171a1b;background-image:none;color:#c8d1d8}body a{color:#00c1ff}body a:hover{color:#0087b3}body .header{background-color:#473864}body h1,body h2,body h3,body h4,body h5,body h6{color:#dddad6}body pre>code,body div.formula-code{background:#22272d;color:#adbac7;border:1px solid #333}body form label{color:#777}body form select,body form input,body form textarea,body form button,body form .textarea,body form input[type=text],body form input[type=email],body form input[type=phone],body form input[type=password],body form input[type=number],body form input[type=search]{border:1px solid #1a1a1a;color:#afafaf;background:#242424;transition:background-color .3s cubic-bezier(0.57, 0.21, 0.69, 1.25),transform .3s cubic-bezier(0.57, 0.21, 0.69, 1.25)}body form button,body form input[type=submit],body form input[type=button],body form input[type=reset]{border:1px solid #262626;background:#333}body form ::placeholder{color:inherit;opacity:1}body .post header nav.toc{border-color:#2f363c}body .post .info-bubble{background-color:#25313c;border-color:#384b5c;color:#c8d1d8}body .post .warn-bubble{background-color:#362521;border-color:#563b34;color:inherit}body .post hr{border-color:#2f363c}body .post #article-details{border-color:#2f363c}body .post #article-details #all-categories{border-color:#2f363c}body .post div.related{border-color:#2f363c}body .post .meta,body .post #article-details{color:#789}body .post .intro::first-letter{color:#00c1ff}body .post blockquote{color:#8b949d;border-left-color:#2f363c}body .post .transparency-fix{background-color:#6f8288}body .button-secondary{background-color:#0ca8ff}body .button-secondary:hover{background-color:#008bd8}body a.button__outline{border:3px solid #00c1ff;color:#00c1ff}body a.button__outline:hover{background-color:#00c1ff;color:#fff}body .post div.related div.container div.item .related-meta,body div.archive_list div.container div.item .related-meta{color:#789}body .post div.related h2,body div.archive_list h2{color:#dddad6}body .footer{background-color:#232729;background-image:none}body .footer .contributions #isso-thread label{color:#777}body .footer .contributions #isso-thread select,body .footer .contributions #isso-thread input,body .footer .contributions #isso-thread textarea,body .footer .contributions #isso-thread button,body .footer .contributions #isso-thread .textarea,body .footer .contributions #isso-thread input[type=text],body .footer .contributions #isso-thread input[type=email],body .footer .contributions #isso-thread input[type=phone],body .footer .contributions #isso-thread input[type=password],body .footer .contributions #isso-thread input[type=number],body .footer .contributions #isso-thread input[type=search]{border:1px solid #1a1a1a;color:#afafaf;background:#242424;transition:background-color .3s cubic-bezier(0.57, 0.21, 0.69, 1.25),transform .3s cubic-bezier(0.57, 0.21, 0.69, 1.25)}body .footer .contributions #isso-thread button,body .footer .contributions #isso-thread input[type=submit],body .footer .contributions #isso-thread input[type=button],body .footer .contributions #isso-thread input[type=reset]{border:1px solid #262626;background:#333}body .footer .contributions #isso-thread ::placeholder{color:inherit;opacity:1}body .footer .contributions #isso-thread>h4{color:#8695a4}body .footer .contributions #isso-thread .isso-comment>div.isso-text-wrapper>.isso-comment-header{color:#789}body .footer .contributions #isso-thread .isso-comment>div.isso-text-wrapper>.isso-comment-header .author{color:#8695a4}body .footer .contributions #isso-thread .isso-comment>.isso-text-wrapper blockquote{border-left-color:#3a3e41;background-color:#1d1f20;color:#9d9488}body .footer .contributions #isso-thread .isso-comment>.isso-text-wrapper code{background:#22272d;color:#adbac7}body .footer .contributions #isso-thread .isso-comment>.isso-text-wrapper pre{background:#22272d;color:#adbac7;border:1px solid #333}body .footer .contributions .note-warning{border:1px solid #171a1b;background-color:#1e2223}body .footer .contributions .note-warning .extra{color:#789}body .footer .bottom{background:#171a1b;color:#789;border-top:2px solid #232729;border-bottom:2px solid #232729}body .footer #footer-comments-widget{border-bottom:2px solid #464f52}body div.archive_list:before,body .posts li:before{background:#3a4244}.video .youtube-play-link{box-shadow:0px 0px 5px 0px rgba(200,200,200,.3)}span.link-logo img{-webkit-filter:invert(100%);filter:invert(100%);opacity:.7}a span.link-logo img{filter:invert(84%) sepia(22%) saturate(6251%) hue-rotate(180deg) brightness(110%) contrast(111%);opacity:1}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark Dimmed
  Description: Dark dimmed theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Colors taken from GitHub's CSS
*/.hljs{color:#adbac7;background:#22272e}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#f47067}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#dcbdfb}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#6cb6ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#96d0ff}.hljs-built_in,.hljs-symbol{color:#f69d50}.hljs-code,.hljs-comment,.hljs-formula{color:#768390}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#8ddb8c}.hljs-subst{color:#adbac7}.hljs-section{color:#316dca;font-weight:700}.hljs-bullet{color:#eac55f}.hljs-emphasis{color:#adbac7;font-style:italic}.hljs-strong{color:#adbac7;font-weight:700}.hljs-addition{color:#b4f1b4;background-color:#1b4721}.hljs-deletion{color:#ffd8d3;background-color:#78191b}}
    </style>
</head>


<body>
   <div class="header">
  <div class="container">
    <div class="inner-container">
      <h1 class="logo"><a href="/">Alex<span class="wide2">andru</span> Nedelcu<span class="wide1" title="strong coffee, java, etc."> ☕️</span></a></h1>
      <nav class="nav-collapse">
        <ul class="noList">
          
          <li class="element first current ">
            <a href="/blog/">Blog</a>
          </li>
          
          <li class="element   ">
            <a href="/wiki/">Wiki</a>
          </li>
          
          <li class="element   ">
            <a href="/links/">Links</a>
          </li>
          
          <li class="element   ">
            <a href="/about/">About</a>
          </li>
          
          <li class="element   last">
            <a href="/subscribe/">Subscribe</a>
          </li>
          
        </ul>
      </nav>
    </div>
  </div>
</div><!-- end .header -->


   <div class="content">
      <div class="container">
         <article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header>
      <h1 class="postTitle" itemprop="headline">
        
        
          
      Scala OOFP Design Sample
    
        
        
      </h1>
    
    <p class="meta">
      <meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="https://alexn.org/blog/2022/04/18/scala-oop-design-sample/"/>
      <meta itemprop="datePublished" content="2022-04-18T00:00:00+0000"/>
      
      <time itemprop="dateCreated" datetime="2022-04-18T00:00:00+0000">April 18, 2022</time>
      | <span class="nobr"><span class="time">22</span> minutes</span>
      
      | <a href="/blog/2022/04/18/scala-oop-design-sample/#isso-thread" class="nobr">Comments</a>
      
    </p>

    
        <figure class="featuredImage" itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://alexn.org/assets/media/articles/2022-04-oofp.png" />
          <img src="/assets/media/articles/2022-04-oofp.png?202411060510" width="1400" height="787" decoding="async" alt="" />
          
        </figure>
        
    

    <div class="hidden" itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
      <meta itemprop="name" content="Alexandru Nedelcu">
      <meta itemprop="url" content="https://alexn.org/about/">
      <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
        <meta itemprop="url" content="https://alexn.org/assets/raw/logo-green.png">
      </div>
    </div>
    <div class="hidden" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alexandru Nedelcu" />
      <meta itemprop="url" content="https://alexn.org/about/" />
      <meta itemprop="url" content="https://x.com/alexelcu" />
      <meta itemprop="url" content="https://github.com/alexandru" />
      <meta itemprop="url" content="https://www.linkedin.com/in/alexelcu/" />
    </div>

    
    
    
    <nav class="toc">
      <p class="toc-title">Table of Contents:</p>
      <ul>
  <li><a href="#the-design-problem">The design problem</a></li>
  <li><a href="#classic-and-impure-oop-design">Classic and impure OOP design</a>
    <ul>
      <li><a href="#beware-constraints-can-be-implementation-leaks">Beware: constraints can be implementation leaks</a></li>
    </ul>
  </li>
  <li><a href="#suspending-side-effects">Suspending side effects</a>
    <ul>
      <li><a href="#beware-io-in-our-api-is-a-constraint">Beware: IO in our API is a constraint!</a></li>
    </ul>
  </li>
  <li><a href="#tagless-final">Tagless Final</a></li>
  <li><a href="#monad-transformers-zio--are-useless-here">Monad Transformers, ZIO … are useless here</a></li>
  <li><a href="#error-handling">Error Handling</a></li>
  <li><a href="#epilogue">Epilogue</a></li>
</ul>
    </nav>
    </header>

  <div id="content" itemprop="articleBody">
    <p class="intro">
Scala is considered a multi-paradigm language, for better or worse, being one of the best OOP languages, which is why it's so versatile. Let's do a design exercise, going from OOP to static FP, and back. Let's understand the various techniques promoted in the community, and understand why the OOP design isn't just “idiomatic” for Scala, but can be superior to alternatives.
</p>
      <h2 id="the-design-problem">
        
        
          The design problem <a href="#the-design-problem" class="anchor">#</a>
        
        
      </h2>
    

<p><strong>Design a <em>“queue of delayed messages.”</em></strong></p>

<p>Should you choose to accept this challenge, the queue should be similar to using a message broker like IBM-MQ, or a Kafka topic, but with the ability to schedule messages to be <em>delivered at exact timestamps in the future</em>. It also has to support an acknowledgement mechanism, with messages becoming invisible when pulled from the queue, and if the acknowledgement doesn’t happen, then messages have to reappear on the queue after a timeout.</p>

<p>As an underlying implementation, we could use a RDBMS database via JDBC — in our project (at $work) we use MS-SQL. But we could also have an in-memory implementation, which is actually super useful, and not just as a mock in tests. And we could migrate to a NoSQL database, such as MongoDB, or Redis, or maybe even Cassandra — anything that can do <a href="https://en.wikipedia.org/wiki/Compare-and-swap">atomic compare-and-swap operations</a> (on keys) should work.</p>

<p>Using a real-world example can be boring, due to all the concerns involved, bear with me…</p>
      <h2 id="classic-and-impure-oop-design">
        
        
          Classic and impure OOP design <a href="#classic-and-impure-oop-design" class="anchor">#</a>
        
        
      </h2>
    

<p>In classic OOP (e.g. Java) we could work with an interface like this:</p>

<pre><code class="language-scala">import java.util.UUID
import java.time.Instant
import scala.concurrent.Future

trait DelayedQueue[A] {
  /** Schedules new messages on the queue. */
  def offer(m: OfferedMessage[A]): Future[OfferOutcome]
  /** Returns messages ready to be processed. */
  def tryPoll: Future[Option[ReceivedMessage[A]]]
  /** Deletes messages from the queue. */
  def discard(key: String): Future[Unit]
}

enum OfferOutcome { // Scala 3's tagged unions
  case Created
  case Updated
  case Ignored
}

final case class OfferedMessage[+A](
  key: String,
  payload: A,
  scheduleAt: Instant,
  canUpdate: Boolean,
)

final case class ReceivedMessage[+A](
  message: A,
  messageID: UUID,
  receivedAt: Instant,
  acknowledge: () =&gt; Future[Unit],
)
</code></pre>

<p>Using this API, to illustrate its usage for building consumers:</p>

<pre><code class="language-scala">import scala.concurrent.ExecutionContext

def drain[A](queue: DelayedQueue[A])(using ExecutionContext): Future[Unit] =
  queue.tryPoll.flatMap {
    case None =&gt; Future.unit
    case Some(msg) =&gt;
      println(s"Received: ${msg.message}")
      // Acknowledge it, or it will reappear after a timeout;
      msg.acknowledge()
        .flatMap(_ =&gt; drain(queue)) // process next
  }
</code></pre>

<p>There are many subtle design choices exposed by this API, which make it an acceptable one. Let’s enumerate …</p>

<p>1) Given the OOP context, we should already have an intuition that <strong>this interface does I/O</strong>, because there aren’t many good reasons for why open-world OOP interfaces are needed, the primary reason being that we need to abstract away implementation details that involve I/O;</p>

<p>2) We are using <code>Future</code>, so <strong>the I/O can be asynchronous</strong>. And <code>Future</code> can be completed with exceptions, so code should install generic exception handlers that do logging or whatever it is that you do with unexpected exceptions;</p>

<p>3) Messages get persisted based on a <code>key: String</code>, because when scheduling messages in advance, we may want to also get rid of them in advance; this “delayed queue” could then be used to trigger timeout exceptions for asynchronous operations that fail to yield a result; it’s why we have a <code>discard(key)</code> operation, which may seem redundant with <code>acknowledge</code> from <code>ReceivedMessage</code>, but isn’t;</p>

<p>4) The generic parameter in <code>DelayedQueue[A]</code> means <strong>we are forced to have a queue per message-type</strong>, which is a best practice, and avoids implementation leaks (more on that below);</p>

<p>5) <strong>All actionable “error” conditions are expressed in the returned types</strong> — in the case of <code>tryPoll</code> via the returned <code>Option</code>, and in the case of <code>offer</code> via the <code>OfferOutcome</code> union type; they don’t seem like errors, because they are <em>“designed away”</em>; in this sample we don’t need <code>Either</code> or Java’s checked exceptions (more on that below);</p>

<p>The interface does have flaws — for example, <code>tryPoll</code> is an operation that has to be repeated, in order to keep the channel open and ready to process messages. If we sleep between successive <code>tryPoll</code> operations, this might be an implementation detail as well. And it can be improved, but how we handle streaming isn’t the purpose of this article.</p>
      <h3 id="beware-constraints-can-be-implementation-leaks">
        
        
          Beware: constraints can be implementation leaks <a href="#beware-constraints-can-be-implementation-leaks" class="anchor">#</a>
        
        
      </h3>
    

<p><a href="https://en.wikipedia.org/wiki/Leaky_abstraction">Leaky abstractions</a> are common when designing abstract APIs. If you don’t have at least 2 very different implementations, the API isn’t really abstract. And in these abstract OOP interfaces, the constraints placed on parameter types lead to leaky abstractions. But let’s put this to the test…</p>

<p>Let’s say we don’t want the <code>A</code> type parameter on the interface, so we could have it per method. But having it per method requires introducing a constraint for serialization/deserialization. Let’s design the type-class:</p>

<pre><code class="language-scala">import monix.newtypes.TypeInfo

class ParsingException(message: String) extends RuntimeException(message)

/**
  * Type-class for serializing and deserializing to and from `String`.
  */
trait ValueCodec[A] {
  def kind: TypeInfo[A]
  def serialize(a: A): String
  def deserialize(s: String): Either[ParsingException, A]
}
</code></pre>

<p>Notes:</p>

<ul>
  <li><a href="https://newtypes.monix.io/api/monix/newtypes/TypeInfo.html">TypeInfo</a> is from <a href="https://github.com/monix/newtypes">monix-newtypes</a>, but you can replace it with a plain <code>String</code> — we are making the <em>name of the type</em> be part of the persisted key, otherwise we can end up with conflicts when reusing the same database table / queue for multiple data types;</li>
  <li>Serialization should never return an error; but deserialization can end in error because we are losing information in the serialization process, thus we cannot force validations via the type system, and this error needs to be very explicitly modeled via the type system, as it’s not just an “exception”;</li>
</ul>

<p>Based on this codec, our interface could become:</p>

<pre><code class="language-scala">trait DelayedQueue {
  def offer[A: ValueCodec](m: OfferedMessage[A]): Future[OfferOutcome]
  def tryPoll[A: ValueCodec]: Future[Option[ReceivedMessage[A]]]
  def discard[A: ValueCodec](key: String): Future[Unit]
}
</code></pre>

<p>You can see how this sucks:</p>

<ul>
  <li>We are encouraging the usage of a single queue for multiple message types;</li>
  <li>The call-sites of those methods are awkward;</li>
  <li><strong>Serialization method is an implementation leak;</strong></li>
</ul>

<p>Serializing the values to string makes no sense for an in-memory implementation. It’s also restrictive, as your database might support a binary serialization format that’s more efficient than string (e.g. protocol buffers).</p>

<p>NOTE — our <code>ValueCodec</code> isn’t useless. We can still use it for our RDBMS implementation:</p>

<pre><code class="language-scala">final class DelayedQueueJDBC[A: ValueCodec] private (
  connection: DataSource,
  //...
) extends DelayedQueue[A] {
  //...
}
</code></pre>

<p>Notice how the constraint is now part of the class’s <em>constructor</em>, and by being a constructor parameter, it doesn’t have to be part of the abstract interface.</p>
      <h2 id="suspending-side-effects">
        
        
          Suspending side effects <a href="#suspending-side-effects" class="anchor">#</a>
        
        
      </h2>
    

<p>We can improve our interface by working with an <code>IO</code> datatype, such as that of <a href="https://typelevel.org/cats-effect/">Cats Effect</a>, replacing our usage of <code>Future</code>:</p>

<pre><code class="language-scala">import cats.effect.IO

trait DelayedQueue[A] {
  def offer(m: OfferedMessage[A]): IO[OfferOutcome]
  def tryPoll: IO[Option[ReceivedMessage[A]]]
  def discard(key: String): IO[Unit]
}

final case class ReceivedMessage[+A](
  //...
  acknowledge: IO[Unit],
)
</code></pre>

<p>Our IO-driven API is definitely an improvement. Due to the usage of <code>IO</code>, it’s even more clear that we are modelling I/O operations with side effects involved. And the applications of these functions are <a href="https://en.wikipedia.org/wiki/Referential_transparency">referentially transparent</a>. We are now proudly making use of FP. For more details on how <code>IO</code> is better than <code>Future</code>, I recommend this presentation:</p>

<figure class="video">
  
  <a href="https://www.youtube.com/watch?v=qgfCmQ-2tW0&amp;autoplay=1" target="_blank" class="youtube-play-link" title="Go to YouTube video">
    <img src="https://img.youtube.com/vi/qgfCmQ-2tW0/maxresdefault.jpg?202411060510" alt="" class="play-thumb" width="1280" height="720" />
  </a>
  <figcaption>
    <a href="https://www.youtube.com/watch?v=qgfCmQ-2tW0&amp;autoplay=1" target="_blank">
      Video link
      (open on YouTube.com)
    </a>
  </figcaption>
</figure>

<p>And, I would argue that usage of <code>IO</code> in this API can be the best you can do in Scala 😉</p>
      <h3 id="beware-io-in-our-api-is-a-constraint">
        
        
          Beware: IO in our API is a constraint! <a href="#beware-io-in-our-api-is-a-constraint" class="anchor">#</a>
        
        
      </h3>
    

<p>By specifying <code>IO</code> we mean that <em>“implementations are free to launch rockets to Mars.”</em> And that’s good in the OOP sense, as we allow for flexibility of implementation, while keeping the protocol abstract enough that we can understand what’s going on.</p>

<p>Static FP proponents usually don’t like this (more details below), but I disagree.</p>
      <h2 id="tagless-final">
        
        
          Tagless Final <a href="#tagless-final" class="anchor">#</a>
        
        
      </h2>
    

<p><code>IO</code> can become a type parameter:</p>

<pre><code class="language-scala">trait DelayedQueue[F[_], A] {
  def offer(m: OfferedMessage[A]): F[OfferOutcome]
  def tryPoll: F[Option[ReceivedMessage[F, A]]]
  def discard(key: String): F[Unit]
}

final case class ReceivedMessage[F[_], +A](
  //...
  acknowledge: F[Unit],
)
</code></pre>

<p><code>F[_]</code> is a placeholder for what we call <em>“an effect”</em>. An effect in the context of FP isn’t a side effect — think of “effects” as anything other than returning the result of a computation.</p>

<p><code>Option</code> and <code>Either</code> are modeling effects too. NOT side effects, but the main effects. In the English language, an effect is something that has a cause, and in our programming language we model causality via <code>flatMap</code>. So, as an incomplete and wrong intuition, effects in Scala are modeled via monadic data-types (types that implement a lawful <code>flatMap</code> and constructor pair, aka <code>Monad</code>).</p>

<p>By making <code>DelayedQueue</code> work with any <code>F[_]</code>:</p>

<ol>
  <li>we could use alternative <code>IO</code> data type implementations;</li>
  <li>we could use monad stacks, e.g. <code>EitherT[IO, *]</code>;</li>
  <li>we could use <a href="https://typelevel.org/cats/datatypes/id.html">cats.Id</a> for really simple and pure tests;</li>
</ol>

<p>And <em>“tagless final”</em> is a technique that’s equivalent to usage of OOP interfaces, except that the interfaces we get are parametrized by <code>F[_]</code>, aka the “effect type”.</p>

<p class="info-bubble">
There are better places on the web that explain tagless final, and I’m likely doing a bad job. For those wanting to learn more about <em>tagless final</em> and its correspondence to object algebras, I recommend <a href="https://www.cs.utexas.edu/~wcook/projects/oa/oa.pdf">“Extensibility for the Masses: Practical Extensibility with Object Algebras”</a> and <a href="https://oleksandrmanzyuk.wordpress.com/2014/06/18/from-object-algebras-to-finally-tagless-interpreters-2/">“From Object Algebras to Finally Tagless Interpreters”</a>.
</p>

<p>In “tagless final” we define capabilities via OOP-like interfaces (also called “algebras”):</p>

<pre><code class="language-scala">trait Logger[F[_]] {
  def info(message: String): F[Unit]
}
</code></pre>

<p>Then to model our consumer, we can combine multiple algebras:</p>

<pre><code class="language-scala">import cats.Monad
import cats.syntax.all._

def drain[F[_], A](using // Scala 3's `implicit`
  Monad[F],
  Logger[F],
  DelayedQueue[F, A]
): F[Unit] =
  summon[DelayedQueue[F, A]].tryPoll.flatMap {
    case None =&gt;
      Applicative[F].unit
    case Some(msg) =&gt;
      summon[Logger[F]].info(s"Received: ${msg.message}")
        .flatMap(_ =&gt; msg.acknowledge) // deletes the message
        .flatMap(_ =&gt; drain[F, A]) // next please
  }
</code></pre>

<p>Let’s ignore the implementation and zoom in on this function’s signature:</p>

<pre><code class="language-scala">def drain[F[_], A](using
  Monad[F],
  Logger[F],
  DelayedQueue[F, A]
): F[Unit]
</code></pre>

<p>We are saying that we want <code>F[_]</code> to implement:</p>

<ul>
  <li><code>Monad</code>: which means a sequencing/chaining of steps is involved, via <code>flatMap</code>;</li>
  <li><code>Logger</code>: which means we want to log something;</li>
  <li><code>DelayedQueue</code>: our queuing capability;</li>
</ul>

<p>This is what’s called <em><a href="https://en.wikipedia.org/wiki/Parametricity">“parametricity”</a></em> in static FP circles: by looking at the function’s signature, we have a pretty good idea of what it does, because the function is so generic that it’s hard for it to do anything else.</p>

<p>And yet there’s something amiss for any seasoned OOP architect — let’s zoom back on the API:</p>

<pre><code class="language-scala">trait DelayedQueue[F[_], A] {
  def offer(m: OfferedMessage[A]): F[OfferOutcome]
  def tryPoll: F[Option[ReceivedMessage[F, A]]]
  def discard(key: String): F[Unit]
}
</code></pre>

<p>In this example, we aren’t talking of any <code>F[_]</code> effect type. It’s ridiculous to think that we can use <code>Either</code> or <code>Option</code> here. If we use <code>Id</code>, we only use it for demonstrative purposes, with absolutely no value.</p>

<p>We say <code>F[_]</code> in this API, but as its authors, we know that we are talking of a data type that encapsulates / suspends side effects, but without saying so. This is the opposite of parametricity, and in this context usage of this style is not good API design, unless you really, really want tagless final in your project, and thus rely on conventions (e.g. whenever you see <code>F[_]</code>, you see <code>IO</code>). The danger being that readers of this code might not get a good mental model of using this API, because there’s information missing, and that’s bad.</p>

<p>To be clear — <strong>this isn’t good API design because <code>F[_]</code> is left unspecified</strong>.</p>

<p>To be fair, we could restrict <code>F[_]</code> to the <a href="https://typelevel.org/cats-effect/docs/typeclasses/concurrent">cats.effect.Concurrent</a> type-class, but at that point we might as well work with <code>IO</code> directly. And if we’d revert to the IO-driven API, we could have:</p>

<pre><code class="language-scala">def drain[A](
  logger: Logger,
  queue: DelayedQueue[A]
): IO[Unit]
</code></pre>

<p>The big difference, in terms of “parametricity”, is that executing an <code>IO</code> could launch rockets to Mars for all we know, so we can’t really restrict the implementation of this function to depend entirely on its input. But this is Scala for you. On top of the JVM we can do anything, anywhere, anyway, relying somewhat on good practices and conventions for not triggering side effects, or using shared mutable state. And while using <code>F[_]</code> can make violations of parametricity harder, it doesn’t make it impossible, and those violations have the potential to be worse, since without <code>IO</code>, you definitely end up with unsuspended side effects.</p>

<p>There is also another difference … implicit parameters mean that we are using only one instance in the whole project. We have only one <code>Logger</code> instance, and only one <code>DelayedQueue[A]</code> instance. This is a best practice. As another example, instances of type-classes need to be unique, because type-classes need <em>coherence</em>, i.e. if you can’t rely on a single instance being available in the whole project, then the code can lead to bugs, due to function calls yielding different results for the same parameters, depending on the call-site.</p>

<p>Nothing stops you from converting to implicit parameters, even without <code>F[_]</code>. I think people abuse implicit parameters, I prefered to reserve use of implicit parameters for type-class instances, but that battle was lost, as with tagless final these “algebras” aren’t necessarily type-classes anyway:</p>

<pre><code class="language-scala">def drain[A](using
  logger: Logger,
  queue: DelayedQueue[A]
): IO[Unit]
</code></pre>

<p>For me (<em>personal opinion warning!</em>), this version is pretty damn explicit about what it does, I don’t see much of a difference in my understanding of it, certainly not a difference that’s big enough to outweigh the cost of introducing higher-kinded types and type-classes. If you’ve been on any medium-sized project, a project that’s regularly looking for promising beginners, I’m pretty sure the concern did come up repeatedly – how in the world are beginners going to cope with learning the use of <code>F[_]</code> with type-classes and everything related? This on top of everything else, which can increase the barrier to entry significantly. And I think the experience of the job market varries based on the available talent.</p>
      <h2 id="monad-transformers-zio--are-useless-here">
        
        
          Monad Transformers, ZIO … are useless here <a href="#monad-transformers-zio--are-useless-here" class="anchor">#</a>
        
        
      </h2>
    

<p>If we’d like to get fancy, we could work with a type that handles “dependency injection” and explicit errors, equivalent to Java’s “checked exceptions”:</p>

<pre><code class="language-scala">type ZIO[-Env, +Error, +Result] =
  Env =&gt; IO[Either[Error, Result]]
</code></pre>

<p>We could work with this, but we have to be careful because the JVM doesn’t do tail-calls optimizations (TCO), so this could be memory unsafe. Also, we need <code>Monad</code> and other type-classes and utilities defined for it, so if using Cats, we could work with:</p>

<pre><code class="language-scala">import cats.data.{EitherT, Kleisli}

type ZIO[Env, Error, Result] =
  Kleisli[[A] =&gt;&gt; EitherT[IO, Error, A], Env, Result]
</code></pre>

<p>We are combining multiple <a href="https://en.wikipedia.org/wiki/Monad_transformer">monad transformers</a>, and so we have a <em>“monad transformers stack”</em>. And to express this type, we are using <a href="https://docs.scala-lang.org/scala3/reference/new-types/type-lambdas.html">type lambdas</a>.</p>

<p>NOTE:</p>

<ul>
  <li>the <code>Env</code> is the “environment”, which specifies what’s needed for the execution of the operation — for example, we might need a JDBC <code>DataSource</code> or a <code>Logger</code>;</li>
  <li>the <code>Error</code> type parameter is for signaling errors that must be handled;</li>
</ul>

<p>This type is equivalent to <a href="https://zio.dev/version-1.x/datatypes/core/zio">ZIO[R, E, A]</a>. A data-type like <code>ZIO</code> is nicer if you use it everywhere, however I prefer the monad transformers from <a href="https://typelevel.org/cats/">Cats</a>, because they are more composable, and we only pay this price where needed … which in my case is almost never 🤷‍♂️</p>

<p>Can we have …</p>

<ol>
  <li>An explicit environment that makes sense in an abstract API?</li>
  <li>An explicit error type that signals currently unspecified error conditions?</li>
</ol>

<p>The answer is NO and NO, because in both cases we are talking of <a href="https://en.wikipedia.org/wiki/Leaky_abstraction">implementation leaks</a>. It doesn’t prevent us from trying, though:</p>

<pre><code class="language-scala">trait DelayedQueue[A] {
  def offer(m: OfferedMessage[A]): ZIO[DataSource, SQLException, OfferOutcome]
  def tryPoll: ZIO[DataSource, SQLException, Option[ReceivedMessage[F, A]]]
  def discard(key: String): ZIO[DataSource, SQLException, Unit]
}
</code></pre>

<p><code>DataSource</code> or <code>SQLException</code> are only relevant for the JDBC-powered implementation, otherwise they are implementation leaks.</p>

<p>For one, I’m always amazed by the people’s struggle to introduce various automated dependency injection techniques in their project, given we have OOP encapsulation and OOP constructors. Haskell’s monad transformer stacks have always felt off, and it isn’t just Scala’s more limited type inference. Haskell is just not very good at encapsulation, as it’s not a very good OOP language, most features and most of its culture conspiring against OOP-like encapsulation. In Scala, if you have dependencies that you’d like to avoid as explicit parameters, the first strategy is to give them as parameters in a class constructor that’s only called once, then pass that object around. Anything else feels like a hack in Scala, IMO, even if constructor-based dependency injection has its drawbacks.</p>

<p>As for errors, one can argue that <code>SQLException</code> is important, and not declaring it in the output type is simply an unspecified error condition. But I’d argue that if it is important, then your API and your application’s design is probably screwed (with exceptions).</p>

<p>I’m repeating myself — we have no important error type that wasn’t already captured in the return types of our API:</p>

<ul>
  <li><code>Option</code> is an effect type that signals <code>None</code> in case there are no messages available; in which case you can stop, or you can retry later;</li>
  <li><code>OfferOutcome</code> is a union data type that tells us if our offering has succeeded or not, taking into account other concurrent offerings;
    <ul>
      <li>But in most cases, it doesn’t matter what this result even is, because after this call is executed, we know for a fact that there is a message scheduled with its corresponding key; so the result itself could be ignored;</li>
    </ul>
  </li>
</ul>

<p>In this context the usage of <code>ZIO</code>, to enhance the return types, would violate an important OOP principle:</p>

<blockquote>
  <p><em>“Program to an interface, not to an implementation.”</em></p>
</blockquote>

<p>This is the equivalent of <em>“parametricity”</em>, except it refers to encapsulating implementation details, and use flexible interfaces in your logic. Abstraction, as a general concept, is not just about observing groups of data types that can be operated in the same way. Abstraction is also about ignoring the non-essential, which is what OOP’s encapsulation and subtype polymorphism are doing.</p>

<p>There is nothing about this <code>ZIO</code> data type that improves our API in any way, quite the contrary, what it brings to the table is only going to obscure what we’re trying to express, as now we are forced to fill in those type parameters with something:</p>

<pre><code class="language-scala">trait DelayedQueue[-Env, A] {
  def offer(m: OfferedMessage[A]): ZIO[Env, Nothing, OfferOutcome]
  def tryPoll: ZIO[Env, Nothing, Option[ReceivedMessage[F, A]]]
  def discard(key: String): ZIO[Env, Nothing, Unit]
}
</code></pre>

<p>Note that <code>IO[A]</code> from Cats Effect is the equivalent of <code>ZIO[Any, Nothing, A]</code> (no, the explicit error type isn’t <code>Throwable</code>). So we have to parametrize the environment and ignore the error type. Or use both as parameters, but that’s just awful.</p>
      <h2 id="error-handling">
        
        
          Error Handling <a href="#error-handling" class="anchor">#</a>
        
        
      </h2>
    

<p>As said multiple times, the important error conditions are already baked into the API. But that’s not entirely accurate — what we did was to design them away. Remember this good principle of software design:</p>

<blockquote>
  <p><em>“Design the errors out of existence.”</em></p>
</blockquote>

<p>An <em>“error”</em>, in the English language, means a mistake, an action which is inaccurate or incorrect. This can happen in our programming due to:</p>

<ol>
  <li>incomplete or incorrect input;</li>
  <li>runtime conditions that are outside of our program’s control;</li>
  <li>bugs;</li>
</ol>

<p>Our programs mostly care about the happy path, but we have to treat errors too. <em>“Designing errors out of existence”</em> means that, if you care about an error, then it shouldn’t be an error. This means:</p>

<ol>
  <li>Model an output data type that expresses the “error” in a way that is hard to ignore — e.g. the result of a parsing function is either the parsed result, or some message that needs to be displayed; but this only works for input errors of functions whose result we depend on (i.e. we have a <em>data dependency</em>), otherwise …</li>
  <li>Make the errors impossible, such that the caller of your API no longer has the responsibility of dealing with those errors;</li>
</ol>

<p><strong>Question</strong> — what can you do with an <a href="https://docs.oracle.com/javase/7/docs/api/java/sql/SQLException.html">SQLException</a>?</p>

<p><strong>Answer: mostly nothing!</strong> The right place to treat an <code>SQLException</code> is in the encapsulated implementation of your API. The lower-level it is, the better. Once you stream that to the client, it’s already too late to do anything about it.</p>

<p>Both Cats’ <a href="https://typelevel.org/cats/datatypes/eithert.html">EitherT</a> and <a href="https://zio.dev/version-1.x/datatypes/core/zio">ZIO</a> exist in order to make errors hard to ignore in instances in which they’d be easy to ignore:</p>

<pre><code class="language-scala">def offer(m: OfferedMessage[A]): IO[Either[SQLException, OfferOutcome]]
</code></pre>

<p>In this case that <code>SQLException</code> can be easy to ignore, as we may not care about the <code>OfferOutcome</code>, so you can easily end up with this:</p>

<pre><code class="language-scala">for {
  _ &lt;- queue.offer(message) // oops!
  _ &lt;- log("done")
} yield ()
</code></pre>

<p>As a band-aid you can make it more difficult to ignore such exceptions by usage of monad transformers, or related data types. The purpose here being to make that <code>flatMap</code> less forgiving:</p>

<pre><code class="language-scala">// cats.EitherT
def offer(m: OfferedMessage[A]): EitherT[IO, SQLException, OfferOutcome]
// ZIO
def offer(m: OfferedMessage[A]): ZIO[Any, SQLException, OfferOutcome]
</code></pre>

<p>Except this is bad software design. Not only is <code>SQLException</code> an implementation leak, the bigger problem is that there are only 2 courses of action:</p>

<ol>
  <li>you can shrug and re-throw it like any other <code>Throwable</code>, such that the process can log it and do whatever it does for unknown exceptions;</li>
  <li>you can retry the operation — and here’s the rub — a retry is best left as an implementation detail, because the retry logic depends on the resource type;</li>
</ol>

<p>And to make matters worse, it’s really hard to parse an <code>SQLException</code>. Anyone that has ever done it knows that these exceptions aren’t standard at all, and sometimes we end up parsing its <code>message</code> in order to ascertain whether the transaction can be retried, or not. And there are multiple policies possible:</p>

<ul>
  <li>in case a concurrent update happened, with the transaction failing, it’s often best for the retry to happen immediately, although it depends on the contention, and it’s good to keep in mind that RDBMS databases don’t do well with many concurrent updates hitting the same table;</li>
  <li>in case the connection is down, or in case of timeouts, using an <a href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential backoff</a> strategy might be wise;</li>
  <li>in case of an SQL syntax error, no retry is possible, of course, so you need to bail out as fast as possible;</li>
</ul>

<p>Note that we probably have to parse <code>SQLException</code> in our implementation, in order to return a usable <code>OfferOutcome</code>. As an API author, if you take the time to parse <code>SQLException</code> such that you can discriminate between such cases, then why not take care of the retry logic yourself? Designing errors out of existence, in this case, means that the user of the API shouldn’t care.</p>

<p>If you’re designing a light-weight API that just wraps JDBC, by all means, expose <code>SQLException</code>, although I’ll be eternally grateful for any JDBC wrapper that avoids exposing <code>SQLException</code> and gives me something more usable, because it is goddamn awful.</p>
      <h2 id="epilogue">
        
        
          Epilogue <a href="#epilogue" class="anchor">#</a>
        
        
      </h2>
    

<p>In application code, in a Scala project, I’d argue that nothing beats the clarity and flexibility of interfaces like this:</p>

<pre><code class="language-scala">import cats.effect.IO

trait DelayedQueue[A] {
  def offer(m: OfferedMessage[A]): IO[OfferOutcome]

  def tryPoll: IO[Option[ReceivedMessage[A]]]

  def discard(key: String): IO[Unit]
}
</code></pre>

<p>For library code, using an <code>F[_]</code> type parameter for the effect type might be better, as it allows people to come up with their monad transformers stack, or a different <code>IO</code> implementation. Such library code allows for a “tagless final” approach, like we’ve seen here, and I admit, people have some good reasons for liking it. However, this doesn’t come without cost, a cost that needs to be balanced by great documentation.</p>

<p>Scala isn’t Haskell, and for me the <em>tagless final</em> approach (powered by implicit parameters / type-classes, or even monad transformers), or ZIO, both proved to be anti-OOP. An “idiomatic” Scala style should use its OOP features for OOP polymorphism, as that’s the <em>“path of least resistance”</em>. And tagless final isn’t incompatible with this approach, but I fear that usage of <code>F[_]</code> or of advanced language features end up obscuring the APIs exposed — compared to just passing IO-driven OOP interfaces around, as simple parameters.</p>

<p>These techniques and advanced features have their place in our toolbox, for sure, and the stronger the types, the better, but nothing beats good taste, or design that focuses on ease of use and the <a href="https://en.wikipedia.org/wiki/The_Design_of_Everyday_Things">user’s mental model</a>, and such skills have less to do with static typing, or the application of math.</p>

<p>Designing good APIs requires empathy for the users of your API. Don’t get me wrong, when you inflict pain on your users, it’s better if that pain is strongly typed, but it would be much better to not inflict that pain at all.</p>

  </div>

  <div id="article-details">
    
    <time itemprop="dateModified" content="2023-06-06T15:19:40+0300">
        Updated: June 6, 2023
    </time>
    | Written by <a href="https://alexn.org/about/" itemprop="url" rel="author">Alexandru Nedelcu</a>

    <div id="all-categories">
      Tags:
      
        
        <a href="/blog/tag/fp/" class="category">FP</a>
      
         | 
        <a href="/blog/tag/oop/" class="category">OOP</a>
      
         | 
        <a href="/blog/tag/scala/" class="category">Scala</a>
      
         | 
        <a href="/blog/tag/scala%203/" class="category">Scala 3</a>
      
    </div>
  </div>

  
  <div class="related">
      <h2 id="related-articles">
        
        
          Related Articles <a href="#related-articles" class="anchor">#</a>
        
        
      </h2>
    
    <div class="container">
      
      
      <div class="item">
        <a class="related-link" href="/blog/2023/09/25/oop-classes-vs-higher-order-functions-hofs/">
          OOP classes vs Higher-order Functions (HOFs)
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/fp" class="tag">FP</a>
            
               | <a href="/blog/tag/oop" class="tag">OOP</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
          </div>
          <time>September 25, 2023</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2022/05/23/tracking-effects-in-scala/">
          Tracking Side Effects in Scala
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/fp" class="tag">FP</a>
            
               | <a href="/blog/tag/monix" class="tag">Monix</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
               | <a href="/blog/tag/scala%203" class="tag">Scala 3</a>
            
          </div>
          <time>May 23, 2022</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      
      <div class="item">
        <a class="related-link" href="/blog/2022/05/13/oop-vs-type-classes-part-1-ideology/">
          OOP vs Type Classes, Part 1: Ideology
        </a>
        <div class="related-meta">
          <div class="tags">
            
            
              <a href="/blog/tag/oop" class="tag">OOP</a>
            
               | <a href="/blog/tag/fp" class="tag">FP</a>
            
               | <a href="/blog/tag/scala" class="tag">Scala</a>
            
          </div>
          <time>May 13, 2022</time>
        </div>
        <div class="clearfix"></div>
      </div>
      
      
      <div class="clearfix"></div>
    </div>
  </div>
  

  
</article>

      </div>
   </div><!-- end .content -->

   <script async src="/assets/js/modernizr.custom.15390.js?202411060510" type="text/javascript"></script>
<script async src="/assets/js-managed/jquery/dist/jquery.slim.min.js?202411060510" type="text/javascript"></script>
<script async src="/assets/js/responsive-nav.min.js?202411060510" type="text/javascript"></script>

<!-- Syntax highlighting (https://highlightjs.org/) -->
<script async src="/assets/js/highlight.min.js" type="text/javascript" onload="hljs.highlightAll();"></script>

<script async src="/assets/js/scripts.js?202411060510" type="text/javascript"></script>


<script type="text/javascript">
  (function () {
    var h = "hostname" in document.location && document.location.hostname || "";
    if (h != "" && h.indexOf("alexn.org") == -1) {
      return
    }
    var p = (function () {
      var query = window.location.search.substring(1);
      var vars = query.split('&');
      var p = {};
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        p[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
      }
      return p;
    })();

    var now = new Date();
    var url = "https://ly.alexn.org/m.php?idsite=1&rec=1&action_name=Scala+OOFP+Design+Sample&url=https%3A%2F%2Falexn.org%2Fblog%2F2022%2F04%2F18%2Fscala-oop-design-sample%2F" +
      "&rand=" + encodeURIComponent(Math.floor(Math.random() * Number.MAX_SAFE_INTEGER)) +
      "&h=" + now.getHours() +
      "&m=" + now.getMinutes() +
      "&s=" + now.getSeconds();

    if ("pk_campaign" in p)
      url += "&_rcn=" + encodeURIComponent(p["pk_campaign"]);
    if ("pk_kwd" in p)
      url += "&_rck=" + encodeURIComponent(p["pk_kwd"]);
    if ("referrer" in document && document.referrer)
      url += "&urlref=" + encodeURIComponent(document.referrer);
    if ("screen" in window)
      url += "&res=" + screen.width + "x" + screen.height;

    var d=document, i=d.createElement("img"),s0=d.getElementsByTagName("script"),s=s0[s0.length-1];
    i.setAttribute("alt", "");
    i.setAttribute("referrerpolicy", "no-referrer-when-downgrade");
    i.setAttribute("src", url);
    i.setAttribute("width", "1");
    i.setAttribute("height", "1");
    i.setAttribute("style", "position: fixed !important; bottom: -1px !important; right: -1px !important; border:none !important; margin:0px !important;");
    s.parentNode.insertBefore(i,s);
  })();
</script>
<noscript>
  <img referrerpolicy="no-referrer-when-downgrade" src="https://ly.alexn.org/m.php?idsite=1&rec=1&action_name=Scala+OOFP+Design+Sample&url=https%3A%2F%2Falexn.org%2Fblog%2F2022%2F04%2F18%2Fscala-oop-design-sample%2F" width="1" height="1" style="position: fixed !important; bottom: -1px !important; right: -1px !important; border:none !important; margin:0px !important;" alt="" />
</noscript>

   <div class="footer">
  
  <div class="container">
    <div class="contributions">
      <div id="footer-comments-widget">
  <h2 id="comments">
  Comments
  <a href="#comments" class="anchor">#</a>
</h2>

<div class="only-js">
  Want to chat in private? Email me:
  <script id="email-script">
    (function () {
      var lhs = "low.flag5454";
      var rhs = "ac.alexn.org";
      var d = document;
      var a = d.createElement("a");
      a.setAttribute("target", "_blank");
      a.setAttribute("href", "mailto:" + lhs + "@" + rhs + "?subject=Comment%20on%3A%20Scala%20OOFP%20Design%20Sample");
      a.text = lhs + "@" + rhs;
      var es = d.getElementById("email-script");
      es.parentNode.insertBefore(a, es);
    })();
  </script>
  <noscript>
    <em>Email address is protected via JavaScript, activate it to see it!</em>
  </noscript>

  <p class="small-note">
    The address is changed periodically to avoid spam.
  </p>
</div>


<div id="comments">
  <script async
          data-isso="https://alexn.org/comments/alexn/"
          data-isso-css="false"
          data-isso-lang="en"
          data-isso-reply-to-self="true"
          data-isso-require-author="true"
          data-isso-require-email="false"
          data-isso-reply-notifications="true"
          data-isso-max-comments-top="30"
          data-isso-max-comments-nested="20"
          data-isso-reveal-on-click="20"
          data-isso-gravatar="true"
          data-isso-avatar="false"
          data-isso-vote="false"
          data-vote-levels=""
          src="https://alexn.org/comments/alexn/js/embed.min.js"></script>
  <section id="isso-thread" data-title="Scala OOFP Design Sample">
  </section>
</div>
<noscript>
  <div class="note-warning">
    <strong>Enable JavaScript to see the email address or the public comments!</strong>
    <br>
    <span class="extra">
      Commenting widget is powered by a self-hosted commenting server.
      <span style="white-space: nowrap;">
        Read the <a href="/docs/privacy-policy/">privacy policy</a>.
      </span>
    </span>
  </div>
</noscript>

</div>

<h2 id="contribute">
  Contribute
  <a href="#contribute" class="anchor">#</a>
</h2>

<p>
  Fix or add to this article by submitting a pull request:<br/>
  <a style="white-space: nowrap;" href="https://github.com/alexandru/alexn.org/blob/main/_posts/2022-04-18-scala-oop-design-sample.md" target="_blank">Edit Page on GitHub</a>
</p>

<p>
  Donate to cover ongoing website costs, or buy me coffee ☕️😋 <br/>
  <a href="https://www.patreon.com/bePatron?u=6102596" target="_blank" class="patreon-button">
    <img label="Become a Patron!" alt="Become a Patron!" title="Become a Patron!" src="/assets/media/buttons/patreon.png" />
  </a>
</p>


<h2 id="subscribe">
  Subscribe
  <a href="#subscribe" class="anchor">#</a>
</h2>

<p>  
  <a target="_blank" href="https://alexn.us4.list-manage.com/subscribe?u=5bffa2af025192a58345bd5dc&id=1c9005b255" rel="nofollow"><span class="link-logo"><img src="/assets/logo/email.svg" /></span>Subscribe by email</a>
  and receive notifications for new blog articles. No spam, just content. 
  Powered by <a href="https://mailchimp.com/" rel="nofollow" target="_blank">Mailchimp</a>. 
  See <a href="/docs/privacy-policy/#email-newsletter">privacy policy</a>.
</p>

<!-- Begin Mailchimp Signup Form -->
<div id="mc_embed_signup">
  <form action="https://alexn.us4.list-manage.com/subscribe/post?u=5bffa2af025192a58345bd5dc&amp;id=1c9005b255"
    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank"
    novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="mc-field-group field">
        <label for="mce-EMAIL">Email Address <sup class="asterisk">*</sup></label>
        <input type="email" value="" name="EMAIL" class="required email full-width" id="mce-EMAIL" placeholder="user@domain.com" required>
      </div>
      <!-- <div class="mc-field-group field">
        <label for="mce-FULLNAME">Name</label>
        <input type="text" value="" name="FULLNAME" class="full-width" id="mce-FULLNAME" placeholder="John Doe">
      </div> -->
      <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text"
          name="b_5bffa2af025192a58345bd5dc_1c9005b255" tabindex="-1" value=""></div>
      <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"
          class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->


    </div>
  </div>
  

  <div class="bottom">
    <div class="container">
      <span class="copy">
          &copy; 2009-2024
      </span>
      <span class="links">
        <a href="/docs/license/">License</a> |
        <a href="/docs/privacy-policy/">Privacy Policy</a> |
        <a href="/about/#contact">Contact</a>
        <span id="other-social-profiles" class="hidden">
          | <a href="https://social.alexn.org/@alexelcu" rel="me">Social</a>
        </span>
      </span>
    </div>
  </div>
</div><!-- end .footer -->

</body>
</html>
